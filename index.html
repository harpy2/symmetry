<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
<title>SYMMETRY</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
:root{--bg:#0a0a12;--bg2:#12121f;--panel:#1a1a2e;--panel2:#16213e;--gold:#f4a824;--gold2:#d4912a;--accent:#9b59b6;--hp:#e74c3c;--hunger:#e67e22;--mood:#3498db;--text:#e0e0e0;--text2:#888;--gray:#555;--blue:#4a9eff;--purple:#a855f7;--orange:#f97316;--green:#22c55e;--red:#ef4444}
html,body{width:100%;height:100%;overflow:hidden;background:var(--bg);color:var(--text);font-family:'Segoe UI',sans-serif;touch-action:manipulation;user-select:none}
.screen{display:none;width:100%;height:100%;flex-direction:column;position:absolute;top:0;left:0}
.screen.active{display:flex}
.btn{background:linear-gradient(135deg,var(--gold2),var(--gold));color:#111;border:none;border-radius:12px;padding:14px 28px;font-size:16px;font-weight:700;cursor:pointer;transition:all .2s;min-height:48px}
.btn:active{transform:scale(.95);filter:brightness(.85)}
.btn-secondary{background:var(--panel2);color:var(--text);border:1px solid var(--gold2)}
.btn-sm{padding:8px 16px;font-size:13px;border-radius:8px}

/* TITLE */
#title-screen{justify-content:center;align-items:center;background:radial-gradient(ellipse at center,#1a1030 0%,#0a0a12 70%)}
#title-screen h1{font-size:52px;letter-spacing:8px;background:linear-gradient(135deg,var(--gold),#fff,var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-shadow:0 0 60px rgba(244,168,36,.3);margin-bottom:8px;animation:titlePulse 3s ease-in-out infinite}
#title-screen .subtitle{color:var(--text2);font-size:14px;margin-bottom:40px;letter-spacing:3px}
@keyframes titlePulse{0%,100%{filter:brightness(1)}50%{filter:brightness(1.3)}}
.title-particles{position:absolute;width:100%;height:100%;overflow:hidden;pointer-events:none}
.title-particles span{position:absolute;width:3px;height:3px;background:var(--gold);border-radius:50%;animation:float-up linear infinite;opacity:0}
@keyframes float-up{0%{transform:translateY(100vh) scale(0);opacity:0}20%{opacity:.8}100%{transform:translateY(-10vh) scale(1);opacity:0}}

/* CLASS SELECT */
#class-screen{background:var(--bg)}
.class-header{text-align:center;padding:20px;font-size:20px;color:var(--gold)}
.class-cards{display:flex;flex-direction:column;gap:12px;padding:0 16px;flex:1;overflow-y:auto;padding-bottom:20px}
.class-card{background:var(--panel);border-radius:16px;padding:16px;display:flex;gap:16px;align-items:center;border:2px solid transparent;transition:all .3s;cursor:pointer}
.class-card:active,.class-card.selected{border-color:var(--gold);box-shadow:0 0 20px rgba(244,168,36,.2)}
.class-avatar{width:80px;height:100px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:40px;position:relative;overflow:hidden}
.class-info{flex:1}
.class-info h3{font-size:18px;margin-bottom:4px;color:var(--gold)}
.class-info p{font-size:12px;color:var(--text2);margin-bottom:6px}
.class-stats{display:flex;gap:8px;flex-wrap:wrap}
.class-stats span{font-size:11px;background:var(--bg);padding:3px 8px;border-radius:6px}
.class-select-btn{padding:16px;text-align:center}

/* SKILL LOADOUT */
#skill-screen{background:var(--bg)}
.skill-header{text-align:center;padding:16px;font-size:18px;color:var(--gold)}
.skill-section{padding:0 12px;margin-bottom:12px}
.skill-section h3{font-size:14px;color:var(--text2);margin-bottom:8px;padding-left:4px}
.skill-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:8px}
.skill-item{background:var(--panel);border-radius:12px;padding:8px;text-align:center;cursor:pointer;border:2px solid transparent;transition:all .2s;min-height:70px;display:flex;flex-direction:column;align-items:center;justify-content:center}
.skill-item.selected{border-color:var(--gold);box-shadow:0 0 15px rgba(244,168,36,.3)}
.skill-item .icon{font-size:22px;margin-bottom:2px}
.skill-item .name{font-size:9px;line-height:1.2}
.skill-desc-box{background:var(--panel);border-radius:12px;padding:12px;margin:8px 12px;min-height:60px}
.skill-desc-box .title{color:var(--gold);font-size:14px;font-weight:700}
.skill-desc-box .desc{color:var(--text2);font-size:12px;margin-top:4px}
.skill-bottom{padding:12px 16px;text-align:center;margin-top:auto}
.selected-count{font-size:12px;color:var(--text2);margin-bottom:8px}
.passive-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}

/* MAIN SCREEN */
#main-screen{background:linear-gradient(180deg,#0d0d1a 0%,#1a1030 50%,#0d0d1a 100%)}
.top-bar{display:flex;justify-content:space-between;padding:12px 16px;font-size:14px;font-weight:700}
.top-bar .gold{color:var(--gold)}
.top-bar .points{color:var(--accent)}
.status-bars{padding:0 16px 8px}
.stat-bar{display:flex;align-items:center;gap:8px;margin-bottom:6px}
.stat-bar .label{font-size:14px;width:24px;text-align:center}
.stat-bar .bar-bg{flex:1;height:16px;background:var(--bg);border-radius:8px;overflow:hidden;position:relative}
.stat-bar .bar-fill{height:100%;border-radius:8px;transition:width .5s}
.stat-bar .bar-text{position:absolute;right:6px;top:50%;transform:translateY(-50%);font-size:10px;font-weight:700;text-shadow:0 1px 2px #000}
.bar-hp .bar-fill{background:linear-gradient(90deg,#c0392b,var(--hp))}
.bar-hunger .bar-fill{background:linear-gradient(90deg,#d35400,var(--hunger))}
.bar-mood .bar-fill{background:linear-gradient(90deg,#2980b9,var(--mood))}

/* CHARACTER */
.char-area{flex:1;display:flex;align-items:center;justify-content:center;position:relative;min-height:200px}
.character{position:relative;animation:charIdle 2s ease-in-out infinite}
@keyframes charIdle{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
.char-body{width:120px;height:160px;border-radius:20px 20px 30px 30px;position:relative;display:flex;flex-direction:column;align-items:center;justify-content:center;box-shadow:0 10px 40px rgba(0,0,0,.5)}
.char-face{position:relative;width:60px;height:40px;margin-top:-10px}
.char-eyes{display:flex;gap:16px;justify-content:center}
.char-eye{width:10px;height:12px;background:#fff;border-radius:50%;position:relative}
.char-eye::after{content:'';position:absolute;width:6px;height:6px;background:#111;border-radius:50%;bottom:2px;left:2px}
.char-mouth{width:16px;height:8px;border-bottom:3px solid #fff;border-radius:0 0 8px 8px;margin:6px auto 0}
.char-mouth.happy{border-bottom-color:#4f4;width:20px}
.char-mouth.sad{border-top:3px solid #fff;border-bottom:none;border-radius:8px 8px 0 0;width:14px}
.char-mouth.angry{border-bottom-color:#f44;width:12px;height:4px}
.char-weapon{position:absolute;right:-30px;top:40%;font-size:28px;animation:weaponBob 2s ease-in-out infinite .5s}
@keyframes weaponBob{0%,100%{transform:rotate(-5deg)}50%{transform:rotate(5deg)}}
.char-glow{position:absolute;width:160px;height:160px;border-radius:50%;top:50%;left:50%;transform:translate(-50%,-50%);filter:blur(40px);opacity:.3;z-index:-1}

/* EQUIP ROW */
.equip-row{display:flex;justify-content:center;gap:8px;padding:8px 16px}
.equip-slot{width:48px;height:48px;background:var(--panel);border-radius:10px;border:2px solid var(--gray);display:flex;align-items:center;justify-content:center;font-size:20px;cursor:pointer;position:relative}
.equip-slot.has-item{border-color:var(--gold)}
.skill-equip-row{display:flex;justify-content:center;gap:8px;padding:4px 16px 8px}
.skill-slot{width:42px;height:42px;background:var(--panel);border-radius:10px;border:1px solid var(--accent);display:flex;align-items:center;justify-content:center;font-size:18px}

/* BOTTOM MENU */
.bottom-menu{display:grid;grid-template-columns:repeat(5,1fr);gap:4px;padding:8px 8px;padding-bottom:max(8px,env(safe-area-inset-bottom))}
.menu-btn{background:var(--panel);border:none;border-radius:12px;padding:10px 4px;color:var(--text);display:flex;flex-direction:column;align-items:center;gap:2px;cursor:pointer;transition:all .2s;min-height:56px}
.menu-btn:active{background:var(--panel2);transform:scale(.95)}
.menu-btn .icon{font-size:20px}
.menu-btn .label{font-size:10px}

/* OVERLAY PANELS */
.overlay{display:none;position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.85);z-index:100;flex-direction:column}
.overlay.active{display:flex}
.overlay-header{display:flex;justify-content:space-between;align-items:center;padding:16px;border-bottom:1px solid #333}
.overlay-header h2{font-size:18px;color:var(--gold)}
.close-btn{background:none;border:none;color:var(--text);font-size:24px;cursor:pointer;width:40px;height:40px;display:flex;align-items:center;justify-content:center}
.overlay-body{flex:1;overflow-y:auto;padding:16px}

/* HUNT */
.hunt-log{display:flex;flex-direction:column;gap:8px}
.hunt-line{opacity:0;animation:fadeIn .5s forwards;font-size:14px;line-height:1.6;padding:4px 8px}
@keyframes fadeIn{to{opacity:1}}
.hunt-line.story{color:var(--text2);font-style:italic}
.hunt-line.action{color:var(--gold)}
.hunt-line.damage{color:var(--red)}
.hunt-line.heal{color:var(--green)}
.hunt-line.loot{color:var(--blue);font-weight:700}
.hunt-line.boss{color:var(--orange);font-size:16px;font-weight:700}
.hunt-line.victory{color:var(--green);font-size:16px;font-weight:700;text-align:center}
.hunt-controls{padding:16px;display:flex;gap:8px;justify-content:center}
.sc-wrap{display:flex;flex-direction:column;align-items:center;gap:12px;padding:16px;background:rgba(0,0,0,.4);border-radius:12px;margin:8px 0}
.sc-gauge{position:relative;width:180px;height:180px}
.sc-gauge svg{width:100%;height:100%}
.sc-btn{padding:14px 32px;background:linear-gradient(135deg,var(--gold),var(--accent));color:#000;border:none;border-radius:12px;font-size:16px;font-weight:700;cursor:pointer;font-family:inherit}
.sc-btn:active{transform:scale(.95)}
.sc-btn:disabled{opacity:.4;cursor:not-allowed}
.sc-info{display:flex;gap:16px;font-size:13px;color:var(--text2)}
.sc-info b{color:var(--text)}
.sc-result{font-size:14px;font-weight:700;min-height:20px}
.auto-hunt-badge{background:var(--green);color:#000;padding:2px 8px;border-radius:8px;font-size:11px;font-weight:700}

/* INVENTORY */
.inv-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:8px}
.inv-slot{aspect-ratio:1;background:var(--panel);border-radius:10px;border:2px solid #333;display:flex;align-items:center;justify-content:center;font-size:22px;cursor:pointer;position:relative;transition:all .2s}
.inv-slot:active{transform:scale(.93)}
.inv-slot.grade-ì¼ë°˜{border-color:#666}
.inv-slot.grade-ë ˆì–´{border-color:var(--blue);box-shadow:0 0 8px rgba(74,158,255,.3)}
.inv-slot.grade-ìœ ë‹ˆí¬{border-color:var(--purple);box-shadow:0 0 8px rgba(168,85,247,.3)}
.inv-slot.grade-ì—í”½{border-color:var(--orange);box-shadow:0 0 12px rgba(249,115,22,.4)}
.inv-slot .dur-bar{position:absolute;bottom:2px;left:4px;right:4px;height:3px;background:#333;border-radius:2px}
.inv-slot .dur-fill{height:100%;background:var(--green);border-radius:2px;transition:width .3s}

/* ITEM DETAIL */
.item-detail{background:var(--panel);border-radius:16px;padding:20px;margin-bottom:16px}
.item-detail .item-name{font-size:18px;font-weight:700;margin-bottom:4px}
.item-detail .item-grade{font-size:12px;margin-bottom:8px}
.item-detail .item-stats{margin-bottom:8px}
.item-detail .item-stats div{font-size:13px;color:var(--text2);padding:2px 0}
.item-detail .item-desc{font-size:12px;color:var(--text2);font-style:italic;border-top:1px solid #333;padding-top:8px;margin-top:8px}
.item-detail .item-actions{display:flex;gap:8px;margin-top:12px}
.grade-ì¼ë°˜-text{color:#999}
.grade-ë ˆì–´-text{color:var(--blue)}
.grade-ìœ ë‹ˆí¬-text{color:var(--purple)}
.grade-ì—í”½-text{color:var(--orange)}

/* SHOP */
.shop-tabs{display:flex;gap:0;padding:0 16px 12px}
.shop-tab{flex:1;padding:10px;text-align:center;background:var(--panel);border:none;color:var(--text2);cursor:pointer;font-size:13px;font-weight:700;transition:all .2s}
.shop-tab:first-child{border-radius:8px 0 0 8px}
.shop-tab:last-child{border-radius:0 8px 8px 0}
.shop-tab.active{background:var(--gold);color:#111}
.shop-items{display:flex;flex-direction:column;gap:8px}
.shop-item{background:var(--panel);border-radius:12px;padding:12px 16px;display:flex;align-items:center;gap:12px;cursor:pointer;transition:all .2s}
.shop-item:active{background:var(--panel2)}
.shop-item .s-icon{font-size:28px;width:44px;text-align:center}
.shop-item .s-info{flex:1}
.shop-item .s-name{font-size:14px;font-weight:700}
.shop-item .s-desc{font-size:11px;color:var(--text2)}
.shop-item .s-price{font-size:14px;font-weight:700;color:var(--gold)}

/* MISSIONS */
.mission-card{background:var(--panel);border-radius:16px;padding:16px;margin-bottom:12px;position:relative}
.mission-card .npc-row{display:flex;gap:12px;align-items:center;margin-bottom:8px}
.mission-card .npc-avatar{width:48px;height:48px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:24px}
.mission-card .npc-name{font-size:14px;font-weight:700;color:var(--gold)}
.mission-card .npc-dialogue{font-size:13px;color:var(--text2);font-style:italic;margin-bottom:12px;line-height:1.5}
.mission-card .mission-reward{font-size:12px;color:var(--green);margin-bottom:8px}
.mission-card .cpq-badge{position:absolute;top:12px;right:12px;background:var(--accent);color:#fff;padding:2px 8px;border-radius:6px;font-size:10px}
.mission-card .cooldown{color:var(--text2);font-size:12px;text-align:center;padding:8px}

/* SKILL MANAGE */
.skill-manage-item{background:var(--panel);border-radius:12px;padding:12px;margin-bottom:8px;display:flex;gap:12px;align-items:center;cursor:pointer;border:2px solid transparent;transition:all .2s}
.skill-manage-item.equipped{border-color:var(--gold);box-shadow:0 0 12px rgba(244,168,36,.2)}
.skill-manage-item .sk-icon{font-size:28px;width:44px;text-align:center}
.skill-manage-item .sk-info{flex:1}
.skill-manage-item .sk-name{font-size:14px;font-weight:700}
.skill-manage-item .sk-desc{font-size:11px;color:var(--text2)}

/* LEVEL UP */
.levelup-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.9);z-index:200;flex-direction:column;align-items:center;justify-content:center}
.levelup-overlay.active{display:flex}
.levelup-title{font-size:32px;color:var(--gold);font-weight:700;margin-bottom:8px;animation:titlePulse 1s ease-in-out infinite}
.levelup-sub{color:var(--text2);font-size:14px;margin-bottom:24px}
.levelup-choices{display:flex;flex-direction:column;gap:12px;width:80%;max-width:300px}
.levelup-choice{background:var(--panel);border:2px solid var(--gold2);border-radius:12px;padding:16px;text-align:center;cursor:pointer;transition:all .2s}
.levelup-choice:active{transform:scale(.95);background:var(--panel2)}
.levelup-choice .lc-name{font-size:16px;font-weight:700;color:var(--gold);margin-bottom:4px}
.levelup-choice .lc-desc{font-size:12px;color:var(--text2)}

/* PARTICLES */
.particles{position:absolute;width:100%;height:100%;pointer-events:none;overflow:hidden;z-index:150}
.particle{position:absolute;border-radius:50%;animation:particleUp 1s ease-out forwards}
@keyframes particleUp{0%{opacity:1;transform:translateY(0) scale(1)}100%{opacity:0;transform:translateY(-80px) scale(0)}}

/* TOAST */
.toast{position:fixed;top:60px;left:50%;transform:translateX(-50%);background:var(--panel);border:1px solid var(--gold);color:var(--text);padding:10px 20px;border-radius:10px;font-size:13px;z-index:300;animation:toastIn .3s,toastOut .3s 2s forwards;white-space:nowrap}
@keyframes toastIn{from{opacity:0;transform:translateX(-50%) translateY(-20px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}
@keyframes toastOut{to{opacity:0;transform:translateX(-50%) translateY(-20px)}}

/* SCROLLBAR */
::-webkit-scrollbar{width:4px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--gray);border-radius:4px}
</style>
</head>
<body>

<!-- TITLE SCREEN -->
<div id="title-screen" class="screen active">
<div class="title-particles" id="title-particles"></div>
<h1>SYMMETRY</h1>
<div class="subtitle">AI í‚¤ìš°ê¸° RPG</div>
<button class="btn" onclick="showScreen('class-screen')">ì‹œì‘í•˜ê¸°</button>
<div style="margin-top:16px"><button class="btn btn-secondary btn-sm" onclick="loadGame()">ì´ì–´í•˜ê¸°</button></div>
</div>

<!-- CLASS SELECT -->
<div id="class-screen" class="screen">
<div class="class-header">âš”ï¸ ì§ì—…ì„ ì„ íƒí•˜ì„¸ìš”</div>
<div class="class-cards" id="class-cards"></div>
<div class="class-select-btn"><button class="btn" onclick="confirmClass()" id="class-confirm-btn" disabled>ì„ íƒ ì™„ë£Œ</button></div>
</div>

<!-- SKILL LOADOUT -->
<div id="skill-screen" class="screen">
<div class="skill-header">âœ¨ ìŠ¤í‚¬ì„ ì„ íƒí•˜ì„¸ìš”</div>
<div style="flex:1;overflow-y:auto">
<div class="skill-section"><h3>ğŸ—¡ï¸ ì•¡í‹°ë¸Œ ìŠ¤í‚¬ (3ê°œ ì„ íƒ)</h3><div class="skill-grid" id="active-skill-grid"></div></div>
<div class="skill-desc-box" id="skill-desc-box"><div class="title">ìŠ¤í‚¬ì„ í„°ì¹˜í•˜ì„¸ìš”</div><div class="desc">ì„¤ëª…ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div></div>
<div class="selected-count" id="active-count">ì„ íƒ: 0/3</div>
<div class="skill-section"><h3>ğŸ›¡ï¸ íŒ¨ì‹œë¸Œ ìŠ¤í‚¬ (2ê°œ ì„ íƒ)</h3><div class="passive-grid" id="passive-skill-grid"></div></div>
<div class="selected-count" id="passive-count">ì„ íƒ: 0/2</div>
</div>
<div class="skill-bottom"><button class="btn" onclick="confirmSkills()" id="skill-confirm-btn" disabled>ì¶œë°œ!</button></div>
</div>

<!-- MAIN SCREEN -->
<div id="main-screen" class="screen">
<div class="top-bar">
<span>â­ Lv.<span id="player-level">1</span></span>
<span class="gold">ğŸ’° <span id="player-gold">100</span></span>
<span class="points">ğŸ’ <span id="player-points">10</span></span>
</div>
<div class="status-bars">
<div class="stat-bar bar-hp"><span class="label">â¤ï¸</span><div class="bar-bg"><div class="bar-fill" id="hp-bar" style="width:100%"></div><span class="bar-text" id="hp-text">100/100</span></div></div>
<div class="stat-bar bar-hunger"><span class="label">ğŸ–</span><div class="bar-bg"><div class="bar-fill" id="hunger-bar" style="width:100%"></div><span class="bar-text" id="hunger-text">100%</span></div></div>
<div class="stat-bar bar-mood"><span class="label">âš¡</span><div class="bar-bg"><div class="bar-fill" id="mood-bar" style="width:80%"></div><span class="bar-text" id="mood-text">80%</span></div></div>
</div>
<div class="char-area" id="char-area"></div>
<div class="equip-row" id="equip-row">
<div class="equip-slot" onclick="openOverlay('inventory','weapon')" title="ë¬´ê¸°">âš”ï¸</div>
<div class="equip-slot" onclick="openOverlay('inventory','armor')" title="ë°©ì–´êµ¬">ğŸ›¡ï¸</div>
<div class="equip-slot" onclick="openOverlay('inventory','accessory')" title="ì¥ì‹ êµ¬">ğŸ“¿</div>
</div>
<div class="skill-equip-row" id="skill-equip-row"></div>
<div class="bottom-menu">
<button class="menu-btn" onclick="openOverlay('hunt')"><span class="icon">âš”ï¸</span><span class="label">ì‚¬ëƒ¥</span></button>
<button class="menu-btn" onclick="openOverlay('mission')"><span class="icon">ğŸ“‹</span><span class="label">ë¯¸ì…˜</span></button>
<button class="menu-btn" onclick="openOverlay('shop')"><span class="icon">ğŸª</span><span class="label">ìƒì </span></button>
<button class="menu-btn" onclick="openOverlay('inventory')"><span class="icon">ğŸ’</span><span class="label">ì¥ë¹„</span></button>
<button class="menu-btn" onclick="openOverlay('skills')"><span class="icon">âœ¨</span><span class="label">ìŠ¤í‚¬</span></button>
</div>
</div>

<!-- OVERLAYS -->
<div class="overlay" id="overlay-hunt">
<div class="overlay-header"><h2>âš”ï¸ ì‚¬ëƒ¥ â€” <span id="hunt-floor">1</span>ì¸µ</h2><div style="display:flex;gap:8px;align-items:center"><span id="auto-hunt-indicator"></span><button class="close-btn" onclick="closeOverlay('hunt')">âœ•</button></div></div>
<div style="padding:8px 16px;display:flex;gap:8px;flex-wrap:wrap;font-size:12px;background:rgba(0,0,0,.3);border-bottom:1px solid var(--gray)">
<span>â¤ï¸ <span id="hunt-hp" style="color:var(--danger)">100/100</span></span>
<span>ğŸ– <span id="hunt-hunger" style="color:var(--gold)">100%</span></span>
<span>âš¡ <span id="hunt-mood" style="color:var(--cyan)">100%</span></span>
<span>â­ Lv.<span id="hunt-level">1</span></span>
<span>ğŸ’° <span id="hunt-gold">0</span></span>
</div>
<div class="overlay-body"><div class="hunt-log" id="hunt-log"></div></div>
<div class="hunt-controls">
<button class="btn" onclick="startHunt()" id="hunt-btn">ğŸ—¡ï¸ ì‚¬ëƒ¥ ì‹œì‘</button>
<button class="btn btn-secondary" onclick="toggleAutoHunt()" id="auto-hunt-btn">ğŸ”„ ìë™ì‚¬ëƒ¥</button>
</div>
</div>

<div class="overlay" id="overlay-mission">
<div class="overlay-header"><h2>ğŸ“‹ ë¯¸ì…˜ ê²Œì‹œíŒ</h2><button class="close-btn" onclick="closeOverlay('mission')">âœ•</button></div>
<div class="overlay-body" id="mission-body"></div>
</div>

<div class="overlay" id="overlay-shop">
<div class="overlay-header"><h2>ğŸª ìƒì </h2><button class="close-btn" onclick="closeOverlay('shop')">âœ•</button></div>
<div class="overlay-body">
<div class="shop-tabs"><button class="shop-tab active" onclick="switchShopTab('gold',this)">ğŸ’° ê³¨ë“œ ìƒì </button><button class="shop-tab" onclick="switchShopTab('point',this)">ğŸ’ í¬ì¸íŠ¸ ìƒì </button></div>
<div class="shop-items" id="shop-items"></div>
</div>
</div>

<div class="overlay" id="overlay-inventory">
<div class="overlay-header"><h2>ğŸ’ ì¥ë¹„</h2><button class="close-btn" onclick="closeOverlay('inventory')">âœ•</button></div>
<div class="overlay-body">
<div id="item-detail-area"></div>
<div class="inv-grid" id="inv-grid"></div>
</div>
</div>

<div class="overlay" id="overlay-skills">
<div class="overlay-header"><h2>âœ¨ ìŠ¤í‚¬ ê´€ë¦¬</h2><button class="close-btn" onclick="closeOverlay('skills')">âœ•</button></div>
<div class="overlay-body" id="skills-body"></div>
</div>

<!-- LEVEL UP -->
<div class="levelup-overlay" id="levelup-overlay">
<div class="particles" id="levelup-particles"></div>
<div class="levelup-title">ğŸ‰ ë ˆë²¨ ì—…!</div>
<div class="levelup-sub" id="levelup-sub">Lv.2 ë‹¬ì„±!</div>
<div style="color:var(--text2);font-size:12px;margin-bottom:8px">ë³´ìƒì„ ì„ íƒí•˜ì„¸ìš”</div>
<div style="margin-bottom:12px"><label style="display:flex;align-items:center;justify-content:center;gap:8px;cursor:pointer;font-size:13px;color:var(--text2)"><input type="checkbox" id="auto-levelup-toggle" onchange="G.autoLevelUp=this.checked;saveGame()" style="width:18px;height:18px;accent-color:var(--gold)"> ğŸ¤– ìë™ ì„ íƒ</label></div>
<div class="levelup-choices" id="levelup-choices"></div>
</div>

<script>
// ===== GAME DATA =====
const CLASSES={
ê±°ë„ˆ:{color:'#22c55e',glow:'#22c55e',weapon:'ğŸ”«',bodyColor:'linear-gradient(180deg,#1a5c2a,#0f3d1a)',desc:'ì›ê±°ë¦¬ ë”œëŸ¬. ì´ê³¼ í­ë°œë¬¼ë¡œ ì ì„ ì„¬ë©¸í•œë‹¤.',baseHP:90,baseATK:18,baseDEF:6,
skills:[
{name:'ìƒ·ê±´',icon:'ğŸ’¥',desc:'ê·¼ê±°ë¦¬ ì‚°íƒ„ â€” ë†’ì€ ë°ë¯¸ì§€',dmg:30},
{name:'ê¸°ê´€ì´',icon:'ğŸ”«',desc:'ì—°ì‚¬ ê³µê²© â€” ë‹¤ì¤‘ íƒ€ê²©',dmg:12,hits:3},
{name:'ìˆ˜ë¥˜íƒ„',icon:'ğŸ’£',desc:'AoE í­ë°œ â€” ê´‘ì—­ ë°ë¯¸ì§€',dmg:22,aoe:true},
{name:'ìŠ¤íŒ€íŒ©',icon:'ğŸ’‰',desc:'ê³µì† ë²„í”„ â€” ATK +30%',buff:true,dmg:0},
{name:'ëŸ¬ì‹œì•ˆë£°ë ›',icon:'ğŸ°',desc:'HP 30% ì´í•˜ ì‹œ í­ë”œ',dmg:50},
{name:'ë„¤ì´íŒœíƒ„',icon:'ğŸ”¥',desc:'ì§€ì† í™”ì—¼ â€” DoT ë°ë¯¸ì§€',dmg:15,dot:true},
{name:'ê´€í†µíƒ„',icon:'ğŸ¯',desc:'ê´€í†µ ì‚¬ê²© â€” ë°©ì–´ ë¬´ì‹œ',dmg:28},
{name:'ì‚°íƒ„í­í’',icon:'ğŸŒªï¸',desc:'360ë„ ì „ì²´ ê³µê²©',dmg:20,aoe:true},
{name:'ë“œë¡ í¬ê²©',icon:'ğŸ¤–',desc:'ìë™ ë“œë¡  ì†Œí™˜ ê³µê²©',dmg:18},
{name:'ì €ê²©',icon:'ğŸ”­',desc:'ì›ê±°ë¦¬ ì´ˆê³ ë°ë¯¸ì§€ ë‹¨ì¼ íƒ€ê²©',dmg:45}],
passives:[
{name:'ì¹˜ëª…íƒ€ +15%',icon:'ğŸ’€',desc:'ì¹˜ëª…íƒ€ í™•ë¥  15% ì¦ê°€'},
{name:'ì¿¨íƒ€ì„ -20%',icon:'â±ï¸',desc:'ìŠ¤í‚¬ ì¿¨íƒ€ì„ 20% ê°ì†Œ'},
{name:'50% ë‘ë°œ ì‹œì „',icon:'ğŸ²',desc:'50% í™•ë¥ ë¡œ ìŠ¤í‚¬ 2íšŒ ì‹œì „'},
{name:'AoE +30%',icon:'ğŸ’«',desc:'ê´‘ì—­ ìŠ¤í‚¬ ë²”ìœ„ 30% ì¦ê°€'},
{name:'ë”¸í”¼ ì  +50%',icon:'â˜ ï¸',desc:'HP ë‚®ì€ ì ì—ê²Œ 50% ì¶”ê°€ ë°ë¯¸ì§€'},
{name:'5íƒ€ ì¶”ê°€íƒ„',icon:'ğŸ”„',desc:'5ë²ˆì§¸ ê³µê²©ë§ˆë‹¤ ì¶”ê°€íƒ„ ë°œì‚¬'}]},
ë§ˆë²•ì‚¬:{color:'#4a9eff',glow:'#4a9eff',weapon:'ğŸª„',bodyColor:'linear-gradient(180deg,#1a3a6c,#0f1f3d)',desc:'ë§ˆë²• ë”œëŸ¬. ì›ì†Œ ë§ˆë²•ìœ¼ë¡œ ì „ì¥ì„ ì§€ë°°í•œë‹¤.',baseHP:80,baseATK:22,baseDEF:5,
skills:[
{name:'íŒŒì´ì–´ë³¼',icon:'ğŸ”¥',desc:'í™”ì—¼ í­ë°œ â€” ë‹¨ì¼ ê³ ë°ë¯¸ì§€',dmg:28},
{name:'ì•„ì´ìŠ¤ë…¸ë°”',icon:'â„ï¸',desc:'AoE ë¹™ê²° â€” ê´‘ì—­+ë‘”í™”',dmg:20,aoe:true},
{name:'ì…ìì™€ íŒŒë™',icon:'âš›ï¸',desc:'50/50 ë‹¨ì¼ ë˜ëŠ” ë²”ìœ„ ê³µê²©',dmg:25},
{name:'ë¸”ë ˆì´ì¦ˆ',icon:'ğŸ”¥',desc:'í™”ì—¼ ìì·¨ â€” ì§€ì† ë°ë¯¸ì§€',dmg:15,dot:true},
{name:'ì‚¬ê±´ì˜ ì§€í‰ì„ ',icon:'ğŸŒ€',desc:'ì¤‘ë ¥ì¥ â€” ì  ì†ë°•',dmg:18},
{name:'ì–¼ìŒë°©íŒ¨',icon:'ğŸ§Š',desc:'5ì´ˆ ë¬´ì  â€” ë°©ì–´ ìŠ¤í‚¬',buff:true,dmg:0},
{name:'ì²´ì¸ë¼ì´íŠ¸ë‹',icon:'âš¡',desc:'5ì—°ì‡„ ë²ˆê°œ ê³µê²©',dmg:14,hits:5},
{name:'ë©”í…Œì˜¤',icon:'â˜„ï¸',desc:'ëŒ€í˜• AoE â€” ìµœê°• ê´‘ì—­ê¸°',dmg:35,aoe:true},
{name:'í…”ë ˆí¬íŠ¸',icon:'âœ¨',desc:'ìˆœê°„ì´ë™ + ë°ë¯¸ì§€',dmg:20},
{name:'ë§ˆë‚˜í­ë°œ',icon:'ğŸ’œ',desc:'HP í¬ìƒ í­ë”œ â€” ê³ ìœ„í—˜ ê³ ë³´ìƒ',dmg:55}],
passives:[
{name:'ë¹™ê²° ì–¼ìŒí™”ì‚´',icon:'ğŸ¹',desc:'ë¹™ê²°ëœ ì ì—ê²Œ ì¶”ê°€ ì–¼ìŒí™”ì‚´'},
{name:'ì¿¨íƒ€ì„ -50%',icon:'â±ï¸',desc:'ìŠ¤í‚¬ ì¿¨íƒ€ì„ 50% ëŒ€í­ ê°ì†Œ'},
{name:'ë¶ˆíƒ€ëŠ” ì  +30%',icon:'ğŸ”¥',desc:'í™”ìƒ ìƒíƒœ ì ì—ê²Œ 30% ì¶”ê°€ ë°ë¯¸ì§€'},
{name:'í‚¬ í›„ ë¬´ì†Œë¹„',icon:'ğŸ’€',desc:'í‚¬ í›„ 3ì´ˆê°„ ë§ˆë‚˜ ì†Œë¹„ ì—†ìŒ'},
{name:'2ì†ì„± í­ë°œ',icon:'ğŸ’¥',desc:'2ê°€ì§€ ì†ì„± ì—°ì† íˆíŠ¸ ì‹œ ë³´ë„ˆìŠ¤ í­ë°œ'},
{name:'ì—°ì‡„í­ë°œ 30%',icon:'ğŸ”—',desc:'AoE í‚¬ ì‹œ 30% í™•ë¥  ì—°ì‡„í­ë°œ'}]},
ì „ì‚¬:{color:'#ef4444',glow:'#ef4444',weapon:'âš”ï¸',bodyColor:'linear-gradient(180deg,#6c1a1a,#3d0f0f)',desc:'ê·¼ì ‘ íƒ±ì»¤/ë”œëŸ¬. ê°•ì¸í•œ ë°©ì–´ì™€ ê°•ë ¥í•œ ê·¼ì ‘ ê³µê²©.',baseHP:120,baseATK:15,baseDEF:10,
skills:[
{name:'ê²€ê¸°',icon:'ğŸ—¡ï¸',desc:'ì›ê±°ë¦¬ ê²€íŒŒ â€” ì¤‘ê±°ë¦¬ ê³µê²©',dmg:24},
{name:'ì¹¼ë‚  ë³µì œ',icon:'ğŸ‘¥',desc:'ë¶„ì‹  ê³µê²© â€” 2íšŒ íƒ€ê²©',dmg:16,hits:2},
{name:'íœ ìœˆë“œ',icon:'ğŸŒ€',desc:'íšŒì „ ê³µê²© â€” ê´‘ì—­ ë°ë¯¸ì§€',dmg:22,aoe:true},
{name:'íšŒì „ì¹¼ë‚ ',icon:'ğŸ’«',desc:'ê¶¤ë„ ì¹¼ë‚  â€” ì§€ì† ë°ë¯¸ì§€',dmg:14,dot:true},
{name:'ìŠ¤í†°í”„',icon:'ğŸ¦¶',desc:'ìŠ¤í„´ â€” ì  í–‰ë™ ë¶ˆê°€',dmg:18},
{name:'ëŒì§„',icon:'ğŸƒ',desc:'ì°¨ì§€+ë„‰ë°± â€” ëŒê²© ê³µê²©',dmg:26},
{name:'ë°©íŒ¨ì˜¬ë¦¬ê¸°',icon:'ğŸ›¡ï¸',desc:'ë°©ì–´+ë°˜ê²© â€” í”¼í•´ ê°ì†Œ',buff:true,dmg:0},
{name:'ì§€ì§„',icon:'ğŸŒ‹',desc:'ì§ì„  ê· ì—´ â€” ë²”ìœ„ ê³µê²©',dmg:28,aoe:true},
{name:'ì „íˆ¬ì˜ í•¨ì„±',icon:'ğŸ“¯',desc:'ATK +30% ë²„í”„',buff:true,dmg:0},
{name:'ì²˜í˜•',icon:'âš°ï¸',desc:'ë”¸í”¼ ì  ì¦‰ì‚¬ê¸‰ â€” ë§ˆë¬´ë¦¬ê¸°',dmg:60}],
passives:[
{name:'í”¼í¡ 20%',icon:'ğŸ©¸',desc:'ë°ë¯¸ì§€ì˜ 20%ë¥¼ HPë¡œ íšŒë³µ'},
{name:'ë°˜ì‚¬ë€ 100%',icon:'ğŸª',desc:'ë°›ëŠ” ë°ë¯¸ì§€ 100% ë°˜ì‚¬'},
{name:'HP +40%',icon:'ğŸ’ª',desc:'ìµœëŒ€ HP 40% ì¦ê°€'},
{name:'ë”¸í”¼ DEF +50%',icon:'ğŸ›¡ï¸',desc:'HP 20% ì´í•˜ ì‹œ DEF 50% ì¦ê°€'},
{name:'ë‚®ì€HP=ë†’ì€ATK',icon:'ğŸ˜¤',desc:'HPê°€ ë‚®ì„ìˆ˜ë¡ ATK ì¦ê°€ (ìµœëŒ€ +50%)'},
{name:'10í”¼ê²© ì™„ì „ë°©ì–´',icon:'ğŸ”°',desc:'10ë²ˆ í”¼ê²©ë§ˆë‹¤ ì™„ì „ ë°©ì–´'}]}
};

const HUNT_TEMPLATES=[
{name:'ì–´ë‘ìš´ ìˆ²',intro:['ìš¸ì°½í•œ ìˆ² ì†ìœ¼ë¡œ ë°œê±¸ìŒì„ ì˜®ê²¼ë‹¤...','ë‚˜ë­‡ê°€ì§€ ì‚¬ì´ë¡œ ë¶ˆê¸¸í•œ ëˆˆë¹›ì´ ë²ˆëœ©ì¸ë‹¤.'],enemies:['ê³ ë¸”ë¦°','ìˆ² ëŠ‘ëŒ€','ë…ë²„ì„¯ ì •ë ¹'],boss:'ìˆ²ì˜ ìˆ˜í˜¸ì ì—”íŠ¸',bossEmoji:'ğŸŒ²'},
{name:'ìŠí˜€ì§„ ë™êµ´',intro:['ìŠµê¸° ì°¬ ë™êµ´ ê¹Šìˆ™ì´ ë“¤ì–´ì„°ë‹¤...','ë²½ë©´ì—ì„œ ê¸°ë¬˜í•œ ë¹›ì´ ìƒˆì–´ë‚˜ì˜¨ë‹¤.'],enemies:['ë°•ì¥ ë–¼','ë™êµ´ íŠ¸ë¡¤','í¬ë¦¬ìŠ¤íƒˆ ê³¨ë ˜'],boss:'ì‹¬ì—°ì˜ ê±°ë¯¸ ì—¬ì™•',bossEmoji:'ğŸ•·ï¸'},
{name:'ê³ ëŒ€ ìœ ì ',intro:['ë¬´ë„ˆì§„ ì‹ ì „ì˜ ì”í•´ë¥¼ ë„˜ì—ˆë‹¤...','ê³µê¸° ì¤‘ì— ë§ˆë ¥ì´ ê°ëˆë‹¤.'],enemies:['ìŠ¤ì¼ˆë ˆí†¤ ë³‘ì‚¬','ì €ì£¼ë°›ì€ ì„ìƒ','ìœ ë ¹ ë§ˆë²•ì‚¬'],boss:'ë¶ˆë©¸ì˜ ë¦¬ì¹˜ ì™•',bossEmoji:'ğŸ’€'},
{name:'í™”ì‚° ì§€ëŒ€',intro:['ë°œë°‘ì—ì„œ ìš©ì•”ì´ ë¶€ê¸€ê±°ë¦°ë‹¤...','ì—´ê¸°ê°€ í”¼ë¶€ë¥¼ íƒœìš¸ ë“¯í•˜ë‹¤.'],enemies:['í™”ì—¼ ë„ë§ˆë±€','ìš©ì•” ìŠ¬ë¼ì„','ë¶ˆì˜ ì •ë ¹'],boss:'í™”ì—¼êµ°ì£¼ ì´í”„ë¦¬íŠ¸',bossEmoji:'ğŸ”¥'},
{name:'ì–¼ì–´ë¶™ì€ ì„¤ì›',intro:['ë§¤ì„œìš´ ëˆˆë³´ë¼ê°€ ì‹œì•¼ë¥¼ ê°€ë¦°ë‹¤...','ë°œìêµ­ì´ ìˆœì‹ê°„ì— ëˆˆì— ë¬»íŒë‹¤.'],enemies:['ì–¼ìŒ ëŠ‘ëŒ€','í”„ë¡œìŠ¤íŠ¸ ê³¨ë ˜','ëˆˆë³´ë¼ ìœ ë ¹'],boss:'ê²¨ìš¸ì™• í”„ë¦¬ì¦ˆë²ˆ',bossEmoji:'â„ï¸'},
{name:'ë…ì˜ ëŠªì§€ëŒ€',intro:['ì§ˆí½í•œ ëŠªì„ ì¡°ì‹¬ìŠ¤ë ˆ ê±·ëŠ”ë‹¤...','ë…ê¸° ì–´ë¦° ì•ˆê°œê°€ í”¼ì–´ì˜¤ë¥¸ë‹¤.'],enemies:['ë… ê°œêµ¬ë¦¬','ëŠªì§€ íˆë“œë¼','ë¶€íŒ¨ ì¢€ë¹„'],boss:'ë…ë£¡ ë² ë…¸ì‚¬ìš°ë¥´',bossEmoji:'ğŸ‰'},
{name:'í•˜ëŠ˜ì˜ íƒ‘',intro:['êµ¬ë¦„ì„ ëš«ê³  ì†Ÿì€ íƒ‘ì— ì˜¬ëë‹¤...','ë°”ëŒì´ ê·“ê°€ì— ì†ì‚­ì¸ë‹¤.'],enemies:['í•˜í”¼','ì²œë‘¥ ë§¤','ë°”ëŒì˜ ì •ë ¹'],boss:'í­í’ì˜ ì§€ë°°ì ë¼ì´ì¿ ',bossEmoji:'âš¡'},
{name:'ì§€í•˜ ê°ì˜¥',intro:['ì‡ ì‚¬ìŠ¬ ëŒë¦¬ëŠ” ì†Œë¦¬ê°€ ìš¸ë ¤í¼ì§„ë‹¤...','ì–´ë‘  ì†ì—ì„œ ì‹ ìŒì´ ë“¤ë¦°ë‹¤.'],enemies:['ê°ì˜¥ ì¥ì¸ê°„','íƒˆì˜¥ ê³¨ë ˜','ì–´ë‘  ê¸°ì‚¬'],boss:'ê³ ë¬¸ê´€ ë¸”ëŸ¬ë“œë©”ì¸',bossEmoji:'â›“ï¸'},
{name:'ë²„ë ¤ì§„ ê´‘ì‚°',intro:['ê´‘ì‚° ìˆ˜ë ˆì˜ ë…¹ìŠ¨ ë°”í€´ê°€ ì‚ê±±ì¸ë‹¤...','ê³¡ê´­ì´ ì†Œë¦¬ê°€ ê¹Šì€ ê³³ì—ì„œ ìš¸ë¦°ë‹¤.'],enemies:['ê´‘ì‚° ë“œì›Œí”„','ë³´ì„ ê±°ë¯¸','í­ë°œ ë°•ì¥'],boss:'ê´‘ì‚°ì™• ë‘ë¦°ì˜ ë§ë ¹',bossEmoji:'â›ï¸'},
{name:'ë‹¬ë¹› ë¬˜ì§€',intro:['ë³´ë¦„ë‹¬ ì•„ë˜ ë¬˜ë¹„ë“¤ì´ ì¤„ì§€ì–´ ì„œìˆë‹¤...','ë•… ì†ì—ì„œ ë¬´ì–¸ê°€ ê¿ˆí‹€ê±°ë¦°ë‹¤.'],enemies:['í•´ê³¨ ê¶ìˆ˜','êµ¬ìš¸','ë°´ì‹œ'],boss:'ì£½ìŒì˜ ê¸°ì‚¬ ëª¨ë¥´ê°€ë‚˜',bossEmoji:'ğŸŒ™'},
{name:'ì‚¬ë§‰ ì˜¤ì•„ì‹œìŠ¤',intro:['ëì—†ëŠ” ëª¨ë˜ì‚¬ë§‰ì„ ê±´ë„Œë‹¤...','ì‹ ê¸°ë£¨ ë„ˆë¨¸ ì˜¤ì•„ì‹œìŠ¤ê°€ ë³´ì¸ë‹¤.'],enemies:['ì‚¬ë§‰ ì „ê°ˆ','ëª¨ë˜ ì›œ','ë¯¸ë¼'],boss:'ì‚¬ë§‰ì˜ íŒŒë¼ì˜¤ ì•„ëˆ„ë¹„ìŠ¤',bossEmoji:'ğŸœï¸'},
{name:'ìˆ˜ì • ë™êµ´',intro:['í˜•í˜•ìƒ‰ìƒ‰ ìˆ˜ì •ì´ ë¹›ì„ ë°œí•œë‹¤...','ê³µëª…í•˜ëŠ” ìˆ˜ì • ì†Œë¦¬ê°€ ê·€ë¥¼ ìš¸ë¦°ë‹¤.'],enemies:['ìˆ˜ì • ë°•ì¥','í”„ë¦¬ì¦˜ ìŠ¬ë¼ì„','ë§ˆë‚˜ í¡ìˆ˜ì²´'],boss:'ìˆ˜ì •ë£¡ í¬ë¦¬ìŠ¤íƒˆë¦¬ì•„',bossEmoji:'ğŸ’'}
];

const ITEM_PREFIX=['ê³ ëŒ€ì˜','ë¶ˆíƒ€ëŠ”','ì–¼ì–´ë¶™ì€','ì €ì£¼ë°›ì€','ì¶•ë³µë°›ì€','ì‹ ë¹„í•œ','í”¼ë¬»ì€','ì˜ì›ì˜'];
const ITEM_MATERIAL=['ê°•ì² ','ë¯¸ìŠ¤ë¦´','í‘ìš”ì„','ë“œë˜ê³¤','ì˜¤ë¦¬í• ì½˜','ì•„ë‹¤ë§Œí‹°ì›€'];
const ITEM_SUFFIX={weapon:['ê²€','ì§€íŒ¡ì´','í™œ','ë„ë¼','ì´'],armor:['ê°‘ì˜·','íˆ¬êµ¬','ì¥ê°‘'],accessory:['ëª©ê±¸ì´','ë°˜ì§€','ë¶€ì ']};
const ITEM_EMOJIS={weapon:['ğŸ—¡ï¸','ğŸª„','ğŸ¹','ğŸª“','ğŸ”«'],armor:['ğŸ›¡ï¸','â›‘ï¸','ğŸ§¤'],accessory:['ğŸ“¿','ğŸ’','ğŸ”®']};
const GRADE_WEIGHTS=[{g:'ì¼ë°˜',w:60},{g:'ë ˆì–´',w:25},{g:'ìœ ë‹ˆí¬',w:12},{g:'ì—í”½',w:3}];
const GRADE_COLORS={ì¼ë°˜:'#999',ë ˆì–´:'var(--blue)',ìœ ë‹ˆí¬:'var(--purple)',ì—í”½:'var(--orange)'};
const FLAVOR_TEXTS=['ì´ ì¥ë¹„ì—ì„œ ì•Œ ìˆ˜ ì—†ëŠ” í˜ì´ ëŠê»´ì§„ë‹¤.','ì˜¤ë˜ëœ ì „ì¥ì˜ ê¸°ì–µì´ ì„œë ¤ìˆë‹¤.','ì œì‘ìì˜ í˜¼ì´ ë‹´ê¸´ ëª…í’ˆì´ë‹¤.','ì–´ë‘  ì†ì—ì„œ í¬ë¯¸í•˜ê²Œ ë¹›ë‚œë‹¤.','ì†ì— ì¥ë©´ ì „ìœ¨ì´ ëŠê»´ì§„ë‹¤.','ìˆ˜ë§ì€ ì „íˆ¬ë¥¼ ê²ªì€ í”ì ì´ ìˆë‹¤.','ì‹ ë¹„ë¡œìš´ ë¬¸ì–‘ì´ ìƒˆê²¨ì ¸ ìˆë‹¤.','ì „ì„¤ ì† ì¥ì¸ì´ ë§Œë“¤ì—ˆë‹¤ê³  ì „í•´ì§„ë‹¤.'];

const LEVELUP_BUFFS=[
{name:'HP +20',desc:'ìµœëŒ€ ì²´ë ¥ 20 ì¦ê°€',apply:p=>{p.maxHP+=20;p.hp=Math.min(p.hp+20,p.maxHP)}},
{name:'ATK +5',desc:'ê³µê²©ë ¥ 5 ì¦ê°€',apply:p=>{p.atk+=5}},
{name:'DEF +3',desc:'ë°©ì–´ë ¥ 3 ì¦ê°€',apply:p=>{p.def+=3}},
{name:'ê³¨ë“œ +100',desc:'ê³¨ë“œ 100 íšë“',apply:p=>{p.gold+=100}},
{name:'HP íšŒë³µ',desc:'HP ì™„ì „ íšŒë³µ',apply:p=>{p.hp=p.maxHP}},
{name:'ë°°ê³ í”” íšŒë³µ',desc:'ë°°ê³ í”” 50 íšŒë³µ',apply:p=>{p.hunger=Math.min(100,p.hunger+50)}},
{name:'ê¸°ë¶„ UP',desc:'ê¸°ë¶„ 30 ì¦ê°€',apply:p=>{p.mood=Math.min(100,p.mood+30)}},
{name:'í¬ë¦¬í‹°ì»¬ +5%',desc:'ì¹˜ëª…íƒ€ í™•ë¥  5% ì¦ê°€',apply:p=>{p.critBonus=(p.critBonus||0)+5}},
];

// ===== GAME STATE =====
let G={};
function newGame(){return{className:'',classData:null,level:1,exp:0,hp:100,maxHP:100,atk:15,def:8,gold:100,points:10,hunger:100,mood:80,floor:1,equippedSkills:[],equippedPassives:[],allSkills:[],allPassives:[],equipment:{weapon:null,armor:null,accessory:null},inventory:[],critBonus:0,autoHunt:false,missionCooldowns:{},lastTick:Date.now()}}

// ===== SCREENS =====
function showScreen(id){document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));document.getElementById(id).classList.add('active');if(id==='class-screen')renderClassSelect();if(id==='main-screen'){renderMainScreen();startTicking()}}

// ===== TITLE PARTICLES =====
(function(){const c=document.getElementById('title-particles');for(let i=0;i<20;i++){const s=document.createElement('span');s.style.left=Math.random()*100+'%';s.style.animationDuration=(3+Math.random()*4)+'s';s.style.animationDelay=Math.random()*5+'s';c.appendChild(s)}})();

// ===== CLASS SELECT =====
function renderClassSelect(){const c=document.getElementById('class-cards');c.innerHTML='';
Object.entries(CLASSES).forEach(([name,cls])=>{
const d=document.createElement('div');d.className='class-card';d.onclick=()=>{document.querySelectorAll('.class-card').forEach(x=>x.classList.remove('selected'));d.classList.add('selected');G=newGame();G.className=name;G.classData=cls;G.maxHP=cls.baseHP;G.hp=cls.baseHP;G.atk=cls.baseATK;G.def=cls.baseDEF;G.allSkills=[...cls.skills];G.allPassives=[...cls.passives];document.getElementById('class-confirm-btn').disabled=false};
d.innerHTML=`<div class="class-avatar" style="background:${cls.bodyColor}"><span style="font-size:36px">${cls.weapon}</span></div><div class="class-info"><h3>${name}</h3><p>${cls.desc}</p><div class="class-stats"><span>â¤ï¸${cls.baseHP}</span><span>âš”ï¸${cls.baseATK}</span><span>ğŸ›¡ï¸${cls.baseDEF}</span></div></div>`;
c.appendChild(d)})}
function confirmClass(){if(!G.className)return;showScreen('skill-screen');renderSkillSelect()}

// ===== SKILL SELECT =====
let selectedActive=new Set(),selectedPassive=new Set(),hoveredSkill=null;
function renderSkillSelect(){selectedActive.clear();selectedPassive.clear();
const ag=document.getElementById('active-skill-grid');ag.innerHTML='';
G.allSkills.forEach((s,i)=>{const d=document.createElement('div');d.className='skill-item';d.onclick=()=>{if(selectedActive.has(i))selectedActive.delete(i);else if(selectedActive.size<3)selectedActive.add(i);renderSkillHighlights();showSkillDesc(s)};d.innerHTML=`<span class="icon">${s.icon}</span><span class="name">${s.name}</span>`;d.id='askill-'+i;ag.appendChild(d)});
const pg=document.getElementById('passive-skill-grid');pg.innerHTML='';
G.allPassives.forEach((s,i)=>{const d=document.createElement('div');d.className='skill-item';d.onclick=()=>{if(selectedPassive.has(i))selectedPassive.delete(i);else if(selectedPassive.size<2)selectedPassive.add(i);renderSkillHighlights();showSkillDesc(s)};d.innerHTML=`<span class="icon">${s.icon}</span><span class="name">${s.name}</span>`;d.id='pskill-'+i;pg.appendChild(d)});
renderSkillHighlights()}
function renderSkillHighlights(){G.allSkills.forEach((_,i)=>{const el=document.getElementById('askill-'+i);if(el)el.className='skill-item'+(selectedActive.has(i)?' selected':'')});
G.allPassives.forEach((_,i)=>{const el=document.getElementById('pskill-'+i);if(el)el.className='skill-item'+(selectedPassive.has(i)?' selected':'')});
document.getElementById('active-count').textContent=`ì„ íƒ: ${selectedActive.size}/3`;
document.getElementById('passive-count').textContent=`ì„ íƒ: ${selectedPassive.size}/2`;
document.getElementById('skill-confirm-btn').disabled=!(selectedActive.size===3&&selectedPassive.size===2)}
function showSkillDesc(s){document.getElementById('skill-desc-box').innerHTML=`<div class="title">${s.icon} ${s.name}</div><div class="desc">${s.desc}</div>`}
function confirmSkills(){G.equippedSkills=[...selectedActive].map(i=>G.allSkills[i]);G.equippedPassives=[...selectedPassive].map(i=>G.allPassives[i]);saveGame();showScreen('main-screen')}

// ===== MAIN SCREEN =====
function renderMainScreen(){updateBars();renderCharacter();renderEquipRow();renderSkillRow()}
function updateBars(){
document.getElementById('player-level').textContent=G.level;
document.getElementById('player-gold').textContent=G.gold;
document.getElementById('player-points').textContent=G.points;
document.getElementById('hp-bar').style.width=(G.hp/G.maxHP*100)+'%';
document.getElementById('hp-text').textContent=`${Math.floor(G.hp)}/${G.maxHP}`;
document.getElementById('hunger-bar').style.width=G.hunger+'%';
document.getElementById('hunger-text').textContent=Math.floor(G.hunger)+'%';
document.getElementById('mood-bar').style.width=G.mood+'%';
document.getElementById('mood-text').textContent=Math.floor(G.mood)+'%'}

function renderCharacter(){const area=document.getElementById('char-area');const cls=CLASSES[G.className];if(!cls)return;
let mouthClass='';if(G.mood>=70)mouthClass='happy';else if(G.mood>=40)mouthClass='';else if(G.mood>=20)mouthClass='sad';else mouthClass='angry';
let weaponEmoji=cls.weapon;if(G.equipment.weapon)weaponEmoji=G.equipment.weapon.emoji||cls.weapon;
let armorStyle=cls.bodyColor;if(G.equipment.armor){const ac=GRADE_COLORS[G.equipment.armor.grade];armorStyle=`linear-gradient(180deg,${ac},#111)`}
area.innerHTML=`<div class="character"><div class="char-glow" style="background:${cls.glow}"></div><div class="char-body" style="background:${armorStyle}"><div class="char-face"><div class="char-eyes"><div class="char-eye"></div><div class="char-eye"></div></div><div class="char-mouth ${mouthClass}"></div></div></div><div class="char-weapon">${weaponEmoji}</div></div>`}

function renderEquipRow(){const row=document.getElementById('equip-row');
const slots=['weapon','armor','accessory'];const labels=['âš”ï¸','ğŸ›¡ï¸','ğŸ“¿'];
row.innerHTML=slots.map((s,i)=>{const item=G.equipment[s];return`<div class="equip-slot ${item?'has-item':''}" onclick="openOverlay('inventory','${s}')" style="${item?'border-color:'+GRADE_COLORS[item.grade]:''}">${item?item.emoji:labels[i]}</div>`}).join('')}

function renderSkillRow(){const row=document.getElementById('skill-equip-row');
row.innerHTML=G.equippedSkills.map(s=>`<div class="skill-slot" title="${s.name}">${s.icon}</div>`).join('')}

// ===== TICKING (hunger, mood) =====
let tickInterval;
function startTicking(){if(tickInterval)clearInterval(tickInterval);
// catch up
const elapsed=(Date.now()-G.lastTick)/1000;
const hungerLoss=elapsed/30;
G.hunger=Math.max(0,G.hunger-hungerLoss);
if(G.hunger<=0)G.hp=Math.max(1,G.hp-elapsed/60*5);
G.lastTick=Date.now();
tickInterval=setInterval(()=>{
G.hunger=Math.max(0,G.hunger-0.033);// ~1% per 30s
if(G.hunger<=0){G.hp=Math.max(1,G.hp-0.08);G.mood=Math.max(0,G.mood-0.02)}
if(G.hunger<20)G.mood=Math.max(0,G.mood-0.01);
G.lastTick=Date.now();
updateBars();renderCharacter();saveGame()},1000)}

// ===== OVERLAYS =====
function openOverlay(name,extra){document.getElementById('overlay-'+name).classList.add('active');
if(name==='hunt')renderHunt();
if(name==='mission')renderMissions();
if(name==='shop')renderShop('gold');
if(name==='inventory')renderInventory(extra);
if(name==='skills')renderSkillManage()}
function closeOverlay(name){document.getElementById('overlay-'+name).classList.remove('active');if(name==='hunt'){G.autoHunt=false;updateAutoHuntUI()}}

// ===== HUNTING =====
let huntInProgress=false;
function renderHunt(){document.getElementById('hunt-floor').textContent=G.floor;updateAutoHuntUI();updateHuntStatus()}
function updateHuntStatus(){var h=document.getElementById('hunt-hp');if(h){h.textContent=Math.floor(G.hp)+'/'+G.maxHP;document.getElementById('hunt-hunger').textContent=Math.floor(G.hunger)+'%';document.getElementById('hunt-mood').textContent=Math.floor(G.mood)+'%';document.getElementById('hunt-level').textContent=G.level;document.getElementById('hunt-gold').textContent=G.gold}}
function updateAutoHuntUI(){document.getElementById('auto-hunt-indicator').innerHTML=G.autoHunt?'<span class="auto-hunt-badge">ìë™</span>':'';document.getElementById('auto-hunt-btn').textContent=G.autoHunt?'â¹ï¸ ìë™ ì¤‘ì§€':'ğŸ”„ ìë™ì‚¬ëƒ¥'}
function toggleAutoHunt(){G.autoHunt=!G.autoHunt;updateAutoHuntUI();if(G.autoHunt&&!huntInProgress)startHunt()}

async function startHunt(){
if(huntInProgress)return;if(G.hp<=0){toast('HPê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!');return}
huntInProgress=true;document.getElementById('hunt-btn').disabled=true;
const log=document.getElementById('hunt-log');log.innerHTML='';
const isBoss=G.floor%5===0;
const tmpl=HUNT_TEMPLATES[Math.floor(Math.random()*HUNT_TEMPLATES.length)];
const enemy=isBoss?tmpl.boss:tmpl.enemies[Math.floor(Math.random()*tmpl.enemies.length)];
const enemyCount=isBoss?1:Math.floor(Math.random()*3)+1;
const enemyHP=isBoss?(30+G.floor*8):(10+G.floor*3);
let totalEnemyHP=enemyHP*enemyCount;

// Intro
for(const line of tmpl.intro)await addHuntLine(line,'story',log);
await wait(400);
if(isBoss){await addHuntLine(`âš ï¸ ë³´ìŠ¤ ì¶œí˜„! ${tmpl.bossEmoji} ${enemy}!`,'boss',log)}
else{await addHuntLine(`${enemy} ${enemyCount}ë§ˆë¦¬ê°€ ë‚˜íƒ€ë‚¬ë‹¤!`,'story',log)}
await wait(300);

// Battle rounds
let rounds=isBoss?5:3+Math.floor(Math.random()*2);
let playerHPLoss=0;
if(isBoss&&!G.autoHunt){
// Boss: skill check mini-game
await addHuntLine('âš¡ ìŠ¤í‚¬ì²´í¬! íƒ€ì´ë°ì„ ë§ì¶°ë¼!','boss',log);
const scResult=await bossSkillCheck(rounds,log);
for(const r of scResult.rounds){
const skill=G.equippedSkills[r.skillIdx%G.equippedSkills.length];
let baseDmg=Math.floor((skill.dmg||20)*(1+G.atk/30));
if(G.equipment.weapon)baseDmg+=Math.floor(G.equipment.weapon.stats.ATK||0);
let dmg=r.type==='critical'?Math.floor(baseDmg*2.5):r.type==='hit'?Math.floor(baseDmg*1):Math.floor(baseDmg*0.3);
totalEnemyHP-=dmg;
const tag=r.type==='critical'?'ğŸ’¥í¬ë¦¬í‹°ì»¬!! ':r.type==='hit'?'âœ… ':'âŒë¹—ë‚˜ê°... ';
await addHuntLine(`${skill.icon} ${skill.name} â†’ ${tag}${dmg} ë°ë¯¸ì§€`,'action',log);
if(r.type==='miss'){const eDmg=Math.max(1,Math.floor((5+G.floor*2)*(0.8+Math.random()*0.4)-G.def/3));playerHPLoss+=eDmg;await addHuntLine(`${enemy}ì˜ ë°˜ê²©! â†’ -${eDmg} HP`,'damage',log)}
await wait(300)}
}else{
// Normal & auto-boss: probability-based
for(let r=0;r<rounds&&totalEnemyHP>0;r++){
const skill=G.equippedSkills[r%G.equippedSkills.length];
let baseDmg=Math.floor((skill.dmg||20)*(1+G.atk/30));
if(G.equipment.weapon)baseDmg+=Math.floor(G.equipment.weapon.stats.ATK||0);
const roll=Math.random()*100;
let dmg,tag;
if(isBoss){
// ë³´ìŠ¤ ìë™: í¬ë¦¬15% ì ì¤‘55% ë¯¸ìŠ¤30%
if(roll<15){dmg=Math.floor(baseDmg*2.5);tag='ğŸ’¥í¬ë¦¬í‹°ì»¬!! '}
else if(roll<70){dmg=Math.floor(baseDmg*(0.8+Math.random()*0.4));tag=''}
else{dmg=Math.floor(baseDmg*0.3);tag='âŒë¹—ë‚˜ê°... '}
}else{
// ì¼ë°˜: í¬ë¦¬10%+ë³´ë„ˆìŠ¤
const critChance=10+(G.critBonus||0);
if(roll<critChance){dmg=Math.floor(baseDmg*1.5);tag='ğŸ’¥í¬ë¦¬í‹°ì»¬! '}
else{dmg=Math.floor(baseDmg*(0.8+Math.random()*0.4));tag=''}
}
totalEnemyHP-=dmg;
await addHuntLine(`${skill.icon} ${skill.name} ì‹œì „! â†’ ${tag}${dmg} ë°ë¯¸ì§€`,'action',log);
await wait(300);
if(tag.includes('ë¹—ë‚˜ê°')){const eDmg=Math.max(1,Math.floor((5+G.floor*2)*(0.8+Math.random()*0.4)-G.def/3));playerHPLoss+=eDmg;await addHuntLine(`${enemy}ì˜ ë°˜ê²©! â†’ -${eDmg} HP`,'damage',log);await wait(200)}
else if(totalEnemyHP>0&&Math.random()<0.4){const eDmg=Math.max(1,Math.floor((3+G.floor)*(0.6+Math.random()*0.4)-G.def/3));playerHPLoss+=eDmg;await addHuntLine(`${enemy}ì˜ ë°˜ê²©! â†’ -${eDmg} HP`,'damage',log);await wait(200)}}
}
}

// Result
const won=totalEnemyHP<=0;
G.hp=Math.max(1,G.hp-playerHPLoss);
G.hunger=Math.max(0,G.hunger-(isBoss?8:4));
if(won){
await addHuntLine('ì „íˆ¬ ìŠ¹ë¦¬! ğŸ‰','victory',log);
const goldReward=Math.floor((10+G.floor*5)*(isBoss?3:1)*(0.8+Math.random()*0.4));
const expReward=Math.floor((15+G.floor*3)*(isBoss?2.5:1));
G.gold+=goldReward;G.exp+=expReward;
G.mood=Math.min(100,G.mood+(isBoss?15:5));
await addHuntLine(`íšë“: ğŸ’° +${goldReward}, ê²½í—˜ì¹˜ +${expReward}`,'loot',log);
// Item drop
if(Math.random()<(isBoss?0.9:0.4)){const item=generateItem();G.inventory.push(item);
await addHuntLine(`ì•„ì´í…œ ë°œê²¬! [${item.name}] (${item.grade})`,'loot',log)}
if(!isBoss)G.floor++;
else{G.floor++;await addHuntLine(`ğŸ† ë³´ìŠ¤ í´ë¦¬ì–´! ${G.floor}ì¸µìœ¼ë¡œ ì§„ì¶œ!`,'victory',log)}
// Level up check
while(G.exp>=100){G.exp-=100;G.level++;G.maxHP+=20;G.atk+=3;G.def+=2;G.hp=G.maxHP;showLevelUp()}
}else{
await addHuntLine('ì „íˆ¬ íŒ¨ë°°... ğŸ’€','damage',log);
G.mood=Math.max(0,G.mood-10)}
updateBars();updateHuntStatus();renderCharacter();renderEquipRow();saveGame();
huntInProgress=false;document.getElementById('hunt-btn').disabled=false;
if(G.autoHunt&&G.hp>G.maxHP*0.2){setTimeout(()=>{if(G.autoHunt)startHunt()},1500)}else{G.autoHunt=false;updateAutoHuntUI()}}

function addHuntLine(text,cls,log){return new Promise(r=>{const d=document.createElement('div');d.className='hunt-line '+cls;d.textContent=text;log.appendChild(d);log.scrollTop=log.scrollHeight;updateHuntStatus();setTimeout(r,200)})}

function bossSkillCheck(totalRounds,log){
return new Promise(resolve=>{
const results=[];let round=0;
const speed=2.5+G.floor*0.15;
const normalZone=18;const critZone=5;

function runRound(){
if(round>=totalRounds){resolve({rounds:results});return}
const wrap=document.createElement('div');wrap.className='sc-wrap';
const critStart=Math.floor(Math.random()*360);
const normalStart=(critStart-normalZone+360)%360;
const normalEnd=(critStart+critZone+normalZone)%360;
const critEnd=(critStart+critZone)%360;
const skill=G.equippedSkills[round%G.equippedSkills.length];

wrap.innerHTML=`
<div style="font-size:13px;color:var(--text2)">${skill.icon} ${skill.name} â€” ë¼ìš´ë“œ ${round+1}/${totalRounds}</div>
<div class="sc-gauge"><svg viewBox="0 0 200 200">
<circle cx="100" cy="100" r="85" fill="none" stroke="rgba(255,255,255,.1)" stroke-width="14"/>
<path d="${descArc(100,100,85,normalStart,(normalStart+normalZone*2+critZone)%360)}" fill="none" stroke="rgba(0,200,100,.35)" stroke-width="14" stroke-linecap="round"/>
<path d="${descArc(100,100,85,critStart,critEnd)}" fill="none" stroke="rgba(255,50,50,.6)" stroke-width="14" stroke-linecap="round"/>
<line id="sc-needle-${round}" x1="100" y1="100" x2="100" y2="20" stroke="var(--gold)" stroke-width="3" stroke-linecap="round"/>
</svg></div>
<div class="sc-info"><span>ğŸŸ¢ ì¼ë°˜</span><span>ğŸ”´ í¬ë¦¬í‹°ì»¬</span></div>
<button class="sc-btn" id="sc-btn-${round}">âš¡ í´ë¦­!</button>
<div class="sc-result" id="sc-res-${round}"></div>`;
log.appendChild(wrap);log.scrollTop=log.scrollHeight;

let angle=0,running=true,anim;
const needle=()=>wrap.querySelector('#sc-needle-'+round);
function tick(){if(!running)return;angle=(angle+speed)%360;const n=needle();if(n)n.setAttribute('transform','rotate('+angle+',100,100)');anim=requestAnimationFrame(tick)}
tick();

const btn=wrap.querySelector('#sc-btn-'+round);
btn.onclick=()=>{
running=false;if(anim)cancelAnimationFrame(anim);btn.disabled=true;
const a=angle;
const inCrit=isInArc(a,critStart,critEnd);
const inNormal=isInArc(a,normalStart,(normalStart+normalZone*2+critZone)%360);
const res=wrap.querySelector('#sc-res-'+round);
let type='miss';
if(inCrit){type='critical';res.innerHTML='<span style="color:var(--red)">ğŸ’¥ í¬ë¦¬í‹°ì»¬!!!</span>'}
else if(inNormal){type='hit';res.innerHTML='<span style="color:var(--green)">âœ… ì ì¤‘!</span>'}
else{res.innerHTML='<span style="color:var(--text2)">âŒ ë¹—ë‚˜ê°...</span>'}
results.push({skillIdx:round,type});round++;
setTimeout(runRound,600)}}
runRound()})
}
function descArc(cx,cy,r,s,e){s=s-90;e=e-90;const sr=s*Math.PI/180,er=e*Math.PI/180;const x1=cx+r*Math.cos(sr),y1=cy+r*Math.sin(sr),x2=cx+r*Math.cos(er),y2=cy+r*Math.sin(er);const large=((e-s+360)%360>180)?1:0;return`M${x1},${y1}A${r},${r},0,${large},1,${x2},${y2}`}
function isInArc(a,s,e){if(e>s)return a>=s&&a<=e;return a>=s||a<=e}
function wait(ms){return new Promise(r=>setTimeout(r,ms))}

// ===== ITEM GENERATION =====
function generateItem(){
const type=['weapon','armor','accessory'][Math.floor(Math.random()*3)];
const suffixes=ITEM_SUFFIX[type];const emojis=ITEM_EMOJIS[type];
const si=Math.floor(Math.random()*suffixes.length);
const prefix=ITEM_PREFIX[Math.floor(Math.random()*ITEM_PREFIX.length)];
const material=ITEM_MATERIAL[Math.floor(Math.random()*ITEM_MATERIAL.length)];
const name=`${prefix} ${material}ì˜ ${suffixes[si]}`;
const roll=Math.random()*100;let grade='ì¼ë°˜';
if(roll<3)grade='ì—í”½';else if(roll<15)grade='ìœ ë‹ˆí¬';else if(roll<40)grade='ë ˆì–´';
const gMult={ì¼ë°˜:1,ë ˆì–´:1.5,ìœ ë‹ˆí¬:2.2,ì—í”½:3.5}[grade];
const floorMult=1+G.floor*0.1;
const stats={};
if(type==='weapon'){stats.ATK=Math.floor((5+Math.random()*10)*gMult*floorMult);if(Math.random()>.5)stats['ì¹˜ëª…íƒ€']=Math.floor(Math.random()*5*gMult)+'%'}
else if(type==='armor'){stats.DEF=Math.floor((3+Math.random()*8)*gMult*floorMult);if(Math.random()>.5)stats.HP=Math.floor(Math.random()*20*gMult)}
else{stats.ATK=Math.floor((2+Math.random()*5)*gMult*floorMult);stats.DEF=Math.floor((1+Math.random()*3)*gMult*floorMult)}
const durability=Math.floor({ì¼ë°˜:50,ë ˆì–´:80,ìœ ë‹ˆí¬:120,ì—í”½:180}[grade]*(0.8+Math.random()*0.4));
return{id:Date.now()+Math.random(),name,type,grade,emoji:emojis[si],stats,durability,maxDurability:durability,desc:FLAVOR_TEXTS[Math.floor(Math.random()*FLAVOR_TEXTS.length)]}}

// ===== INVENTORY =====
let invFilter=null;
function renderInventory(filter){invFilter=filter||null;
const detail=document.getElementById('item-detail-area');detail.innerHTML='';
const grid=document.getElementById('inv-grid');grid.innerHTML='';
for(let i=0;i<30;i++){const item=G.inventory[i];const d=document.createElement('div');d.className='inv-slot'+(item?' grade-'+item.grade:'');
if(item){d.innerHTML=`<span>${item.emoji}</span><div class="dur-bar"><div class="dur-fill" style="width:${item.durability/item.maxDurability*100}%"></div></div>`;d.onclick=()=>showItemDetail(i)}
grid.appendChild(d)}}

function showItemDetail(idx){const item=G.inventory[idx];if(!item)return;
const d=document.getElementById('item-detail-area');
const statsHTML=Object.entries(item.stats).map(([k,v])=>`<div>${k}: +${v}</div>`).join('');
const isEquipped=Object.values(G.equipment).some(e=>e&&e.id===item.id);
d.innerHTML=`<div class="item-detail"><div class="item-name grade-${item.grade}-text" style="color:${GRADE_COLORS[item.grade]}">${item.name}</div><div class="item-grade" style="color:${GRADE_COLORS[item.grade]}">${item.grade} ${item.type==='weapon'?'ë¬´ê¸°':item.type==='armor'?'ë°©ì–´êµ¬':'ì¥ì‹ êµ¬'}</div><div class="item-stats">${statsHTML}</div><div style="font-size:12px;color:var(--text2)">ë‚´êµ¬ë„: ${item.durability}/${item.maxDurability}</div><div class="item-desc">${item.desc}</div><div class="item-actions">${isEquipped?`<button class="btn btn-sm btn-secondary" onclick="unequipItem('${item.type}')">í•´ì œ</button>`:`<button class="btn btn-sm" onclick="equipItem(${idx})">ì¥ì°©</button>`}<button class="btn btn-sm btn-secondary" onclick="repairItem(${idx})">ìˆ˜ë¦¬ (ğŸ’°${Math.floor((item.maxDurability-item.durability)*0.5)})</button><button class="btn btn-sm btn-secondary" onclick="sellItem(${idx})">íŒë§¤ (ğŸ’°${Math.floor(({ì¼ë°˜:5,ë ˆì–´:15,ìœ ë‹ˆí¬:40,ì—í”½:100}[item.grade])*(1+G.floor*0.1))})</button></div></div>`}

function equipItem(idx){const item=G.inventory[idx];if(!item)return;
if(G.equipment[item.type])G.inventory.push(G.equipment[item.type]);
G.equipment[item.type]=item;G.inventory.splice(idx,1);
toast(`${item.name} ì¥ì°©!`);renderInventory();renderEquipRow();renderCharacter();saveGame()}
function unequipItem(type){if(!G.equipment[type])return;G.inventory.push(G.equipment[type]);G.equipment[type]=null;
toast('ì¥ë¹„ í•´ì œ');renderInventory();renderEquipRow();renderCharacter();saveGame()}
function repairItem(idx){const item=G.inventory[idx];if(!item)return;const cost=Math.floor((item.maxDurability-item.durability)*0.5);if(G.gold<cost){toast('ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!');return}G.gold-=cost;item.durability=item.maxDurability;toast('ìˆ˜ë¦¬ ì™„ë£Œ!');renderInventory();showItemDetail(idx);updateBars();saveGame()}
function sellItem(idx){const item=G.inventory[idx];if(!item)return;const price=Math.floor(({ì¼ë°˜:5,ë ˆì–´:15,ìœ ë‹ˆí¬:40,ì—í”½:100}[item.grade])*(1+G.floor*0.1));G.gold+=price;G.inventory.splice(idx,1);toast(`íŒë§¤ ì™„ë£Œ! ğŸ’°+${price}`);document.getElementById('item-detail-area').innerHTML='';renderInventory();updateBars();saveGame()}

// ===== SHOP =====
let currentShopTab='gold';
const GOLD_SHOP=[
{name:'ë¹µ',icon:'ğŸ',desc:'ë°°ê³ í”” 30 íšŒë³µ',price:20,currency:'gold',action:()=>{G.hunger=Math.min(100,G.hunger+30);toast('ë¹µì„ ë¨¹ì—ˆë‹¤! ğŸ')}},
{name:'ìŠ¤í…Œì´í¬',icon:'ğŸ¥©',desc:'ë°°ê³ í”” 70 íšŒë³µ',price:50,currency:'gold',action:()=>{G.hunger=Math.min(100,G.hunger+70);toast('ìŠ¤í…Œì´í¬ë¥¼ ë¨¹ì—ˆë‹¤! ğŸ¥©')}},
{name:'HP í¬ì…˜',icon:'ğŸ§ª',desc:'HP 50 íšŒë³µ',price:30,currency:'gold',action:()=>{G.hp=Math.min(G.maxHP,G.hp+50);toast('HP íšŒë³µ! ğŸ§ª')}},
{name:'ê³ ê¸‰ HP í¬ì…˜',icon:'âš—ï¸',desc:'HP ì™„ì „ íšŒë³µ',price:80,currency:'gold',action:()=>{G.hp=G.maxHP;toast('HP ì™„ì „ íšŒë³µ! âš—ï¸')}},
{name:'ê¸°ë¶„ì „í™˜ ë§¥ì£¼',icon:'ğŸº',desc:'ê¸°ë¶„ 40 íšŒë³µ',price:25,currency:'gold',action:()=>{G.mood=Math.min(100,G.mood+40);toast('ê¸°ë¶„ì´ ì¢‹ì•„ì¡Œë‹¤! ğŸº')}},
];
const POINT_SHOP=[
{name:'ì—˜ë¦­ì„œ',icon:'âœ¨',desc:'ì¥ë¹„ ë‚´êµ¬ë„ ì˜êµ¬í™” (ë¯¸êµ¬í˜„)',price:50,currency:'point',action:()=>{toast('ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤!')}},
{name:'ìŠ¤í‚¬ ë¦¬ì…‹',icon:'ğŸ”„',desc:'ìŠ¤í‚¬ ë¡œë“œì•„ì›ƒ ì´ˆê¸°í™”',price:30,currency:'point',action:()=>{showScreen('skill-screen');renderSkillSelect();toast('ìŠ¤í‚¬ì„ ë‹¤ì‹œ ì„ íƒí•˜ì„¸ìš”!')}},
{name:'ìºë¦­í„° ìŠ¬ë¡¯',icon:'ğŸ‘¤',desc:'ì¶”ê°€ ìºë¦­í„° ìŠ¬ë¡¯',price:100,currency:'point',disabled:true,action:()=>{toast('ì¤€ë¹„ì¤‘...')}},
];
function renderShop(tab){currentShopTab=tab;
document.querySelectorAll('.shop-tab').forEach((t,i)=>t.classList.toggle('active',i===(tab==='gold'?0:1)));
const items=tab==='gold'?GOLD_SHOP:POINT_SHOP;
document.getElementById('shop-items').innerHTML=items.map((item,i)=>`<div class="shop-item ${item.disabled?'style="opacity:.4"':''}" onclick="buyShopItem('${tab}',${i})"><div class="s-icon">${item.icon}</div><div class="s-info"><div class="s-name">${item.name}</div><div class="s-desc">${item.desc}</div></div><div class="s-price">${tab==='gold'?'ğŸ’°':'ğŸ’'} ${item.price}</div></div>`).join('')}
function switchShopTab(tab,el){renderShop(tab)}
function buyShopItem(tab,idx){const items=tab==='gold'?GOLD_SHOP:POINT_SHOP;const item=items[idx];if(item.disabled)return toast('ì¤€ë¹„ì¤‘ì…ë‹ˆë‹¤!');
const cur=tab==='gold'?'gold':'points';if(G[cur]<item.price)return toast('ì¬í™”ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!');
G[cur]-=item.price;item.action();updateBars();renderCharacter();saveGame()}

// ===== MISSIONS =====
const MISSIONS=[
{npc:'ëŒ€ì¥ì¥ì´ ëª¨ë£¨ìŠ¤',avatar:'ğŸ”¨',color:'#8B4513',dialogue:'ìš©ì‚¬ì—¬, ë‚´ ëŒ€ì¥ê°„ì— ì“¸ ì¬ë£Œê°€ ë¶€ì¡±í•˜ì˜¤. ëª¨í—˜ ì¤‘ì— ê´‘ì„ì„ ì°¾ì•„ì™€ ì£¼ì‹œì˜¤!',reward:'ğŸ’° 80 + ğŸ’ 5',gold:80,points:5},
{npc:'ë§ˆë²•ì‚¬ ì—˜ë“œë¦°',avatar:'ğŸ§™',color:'#4B0082',dialogue:'ê³ ëŒ€ ë§ˆë²•ì§„ì˜ ì”ì¬ë¥¼ ì—°êµ¬ ì¤‘ì´ì˜¤. ìœ ì ì—ì„œ ë§ˆë ¥ ê²°ì •ì„ ê°€ì ¸ë‹¤ ì£¼ì‹œì˜¤.',reward:'ğŸ’° 60 + ğŸ’ 8',gold:60,points:8},
{npc:'ì •ì°°ë³‘ ì¹´ì´',avatar:'ğŸ¹',color:'#2F4F4F',dialogue:'ìˆ² ì™¸ê³½ì— ìˆ˜ìƒí•œ ì›€ì§ì„ì´ í¬ì°©ëìŠµë‹ˆë‹¤. ì •ì°°ì„ ë¶€íƒë“œë¦½ë‹ˆë‹¤!',reward:'ğŸ’° 50 + ğŸ’ 3',gold:50,points:3},
{npc:'ì£¼ì ì£¼ì¸ ë¦´ë¼',avatar:'ğŸº',color:'#8B008B',dialogue:'ìš”ì¦˜ ì†ë‹˜ë“¤ì´ ì´ìƒí•œ ì†Œë¬¸ì„ í¼ëœ¨ë¦¬ê³  ìˆì–´ìš”. ì§„ìƒì„ ì•Œì•„ë´ ì£¼ì„¸ìš”~',reward:'ğŸ’° 40 + ğŸ’ 10',gold:40,points:10}
];
function renderMissions(){const body=document.getElementById('mission-body');body.innerHTML='';
MISSIONS.forEach((m,i)=>{const cd=G.missionCooldowns[i]||0;const remaining=Math.max(0,cd-Date.now());const onCD=remaining>0;
body.innerHTML+=`<div class="mission-card"><div class="cpq-badge">CPQ ë¯¸ì…˜</div><div class="npc-row"><div class="npc-avatar" style="background:${m.color}">${m.avatar}</div><div><div class="npc-name">${m.npc}</div></div></div><div class="npc-dialogue">"${m.dialogue}"</div><div class="mission-reward">ë³´ìƒ: ${m.reward}</div>${onCD?`<div class="cooldown">â³ ëŒ€ê¸° ì¤‘... ${Math.ceil(remaining/1000)}ì´ˆ</div>`:`<button class="btn btn-sm" onclick="completeMission(${i})">ì™„ë£Œ</button>`}</div>`})}
function completeMission(i){const m=MISSIONS[i];G.gold+=m.gold;G.points+=m.points;G.missionCooldowns[i]=Date.now()+30000;
toast(`ë¯¸ì…˜ ì™„ë£Œ! ğŸ’°+${m.gold} ğŸ’+${m.points}`);updateBars();saveGame();renderMissions();
// refresh cooldowns
const refreshTimer=setInterval(()=>{if(!document.getElementById('overlay-mission').classList.contains('active')){clearInterval(refreshTimer);return}renderMissions()},1000)}

// ===== SKILL MANAGE =====
function renderSkillManage(){const body=document.getElementById('skills-body');body.innerHTML='<h3 style="color:var(--gold);margin-bottom:12px">ğŸ—¡ï¸ ì•¡í‹°ë¸Œ ìŠ¤í‚¬</h3>';
G.allSkills.forEach((s,i)=>{const equipped=G.equippedSkills.some(e=>e.name===s.name);
body.innerHTML+=`<div class="skill-manage-item ${equipped?'equipped':''}" onclick="toggleSkillEquip(${i},'active')"><div class="sk-icon">${s.icon}</div><div class="sk-info"><div class="sk-name">${s.name} ${equipped?'âœ…':''}</div><div class="sk-desc">${s.desc}</div></div></div>`});
body.innerHTML+='<h3 style="color:var(--gold);margin:16px 0 12px">ğŸ›¡ï¸ íŒ¨ì‹œë¸Œ ìŠ¤í‚¬</h3>';
G.allPassives.forEach((s,i)=>{const equipped=G.equippedPassives.some(e=>e.name===s.name);
body.innerHTML+=`<div class="skill-manage-item ${equipped?'equipped':''}" onclick="toggleSkillEquip(${i},'passive')"><div class="sk-icon">${s.icon}</div><div class="sk-info"><div class="sk-name">${s.name} ${equipped?'âœ…':''}</div><div class="sk-desc">${s.desc}</div></div></div>`})}
function toggleSkillEquip(idx,type){
if(type==='active'){const s=G.allSkills[idx];const ei=G.equippedSkills.findIndex(e=>e.name===s.name);
if(ei>=0)G.equippedSkills.splice(ei,1);else if(G.equippedSkills.length<3)G.equippedSkills.push(s);else{toast('ìµœëŒ€ 3ê°œê¹Œì§€ ì¥ì°© ê°€ëŠ¥í•©ë‹ˆë‹¤');return}}
else{const s=G.allPassives[idx];const ei=G.equippedPassives.findIndex(e=>e.name===s.name);
if(ei>=0)G.equippedPassives.splice(ei,1);else if(G.equippedPassives.length<2)G.equippedPassives.push(s);else{toast('ìµœëŒ€ 2ê°œê¹Œì§€ ì¥ì°© ê°€ëŠ¥í•©ë‹ˆë‹¤');return}}
renderSkillManage();renderSkillRow();saveGame()}

// ===== LEVEL UP =====
function showLevelUp(){const ol=document.getElementById('levelup-overlay');ol.classList.add('active');
document.getElementById('levelup-sub').textContent=`Lv.${G.level} ë‹¬ì„±! HP+20, ATK+3, DEF+2`;
const choices=[];const pool=[...LEVELUP_BUFFS];
for(let i=0;i<3;i++){const idx=Math.floor(Math.random()*pool.length);choices.push(pool.splice(idx,1)[0])}
document.getElementById('levelup-choices').innerHTML=choices.map((c,i)=>`<div class="levelup-choice" onclick="pickLevelBuff(${i})"><div class="lc-name">${c.name}</div><div class="lc-desc">${c.desc}</div></div>`).join('');
// particles
const pc=document.getElementById('levelup-particles');pc.innerHTML='';
for(let i=0;i<30;i++){const p=document.createElement('div');p.className='particle';p.style.left=Math.random()*100+'%';p.style.top=Math.random()*100+'%';p.style.width=p.style.height=(4+Math.random()*8)+'px';p.style.background=['var(--gold)','#fff','var(--accent)','var(--green)'][Math.floor(Math.random()*4)];p.style.animationDelay=Math.random()*2+'s';p.style.animationDuration=(0.5+Math.random())+'s';pc.appendChild(p)}
window._levelChoices=choices;
document.getElementById('auto-levelup-toggle').checked=!!G.autoLevelUp;
if(G.autoLevelUp){setTimeout(()=>pickLevelBuff(Math.floor(Math.random()*3)),500);return}}
function pickLevelBuff(i){window._levelChoices[i].apply(G);
document.getElementById('levelup-overlay').classList.remove('active');
toast(`${window._levelChoices[i].name} íšë“!`);updateBars();renderCharacter();saveGame()}

// ===== TOAST =====
function toast(msg){const t=document.createElement('div');t.className='toast';t.textContent=msg;document.body.appendChild(t);setTimeout(()=>t.remove(),2500)}

// ===== SAVE/LOAD =====
function saveGame(){const s={...G};delete s.classData;s.className_=G.className;localStorage.setItem('symmetry_save',JSON.stringify(s))}
function loadGame(){const raw=localStorage.getItem('symmetry_save');if(!raw){toast('ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤');return}
try{const s=JSON.parse(raw);G=s;G.className=s.className_;G.classData=CLASSES[G.className];if(!G.classData){toast('ì˜ëª»ëœ ì„¸ì´ë¸Œ ë°ì´í„°');return}
G.allSkills=G.classData.skills;G.allPassives=G.classData.passives;
// Restore skill references
G.equippedSkills=G.equippedSkills.map(es=>G.allSkills.find(s=>s.name===es.name)||es);
G.equippedPassives=G.equippedPassives.map(ep=>G.allPassives.find(p=>p.name===ep.name)||ep);
if(!G.missionCooldowns)G.missionCooldowns={};if(!G.critBonus)G.critBonus=0;
showScreen('main-screen');toast('ê²Œì„ ë¡œë“œ ì™„ë£Œ!')}catch(e){toast('ë¡œë“œ ì‹¤íŒ¨: '+e.message)}}

// Init
renderClassSelect();
</script>
</body>
</html>
