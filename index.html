<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, viewport-fit=cover">
<title>SYMMETRY</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
:root{
--bg1:#0a0a0f;--bg2:#1a1025;--bg3:#12101c;
--gold:#f0c040;--gold2:#d4912a;--gold-glow:rgba(240,192,64,.25);
--cyan:#00d4ff;--cyan-glow:rgba(0,212,255,.2);
--danger:#ff4466;--success:#00e88f;
--accent:#9b59b6;
--hp:#ff4466;--hunger:#f0a030;--mood:#00d4ff;
--text:#f0ebe3;--text2:#8a8a9a;--text3:#555;
--glass:rgba(255,255,255,.06);--glass-border:rgba(255,255,255,.08);
--panel:rgba(20,18,30,.75);--panel2:rgba(30,25,45,.8);
--blue:#4a9eff;--purple:#a855f7;--orange:#f97316;--green:#22c55e;--red:#ef4444;
--safe-bottom:max(12px,env(safe-area-inset-bottom));
--safe-top:max(0px,env(safe-area-inset-top));
}
html,body{width:100%;height:100dvh;overflow:hidden;background:var(--bg1);color:var(--text);font-family:'Noto Sans KR',sans-serif;font-weight:400;touch-action:manipulation;user-select:none;-webkit-user-select:none;overscroll-behavior:none}
.screen{display:none;width:100%;height:100dvh;flex-direction:column;position:absolute;top:0;left:0;opacity:0;transform:scale(.98);transition:opacity .3s cubic-bezier(.4,0,.2,1),transform .3s cubic-bezier(.4,0,.2,1)}
.screen.active{display:flex;opacity:1;transform:scale(1)}

/* === BUTTONS === */
.btn{background:linear-gradient(135deg,var(--gold2),var(--gold));color:#111;border:none;border-radius:14px;padding:14px 32px;font-size:15px;font-weight:700;cursor:pointer;transition:all .2s cubic-bezier(.4,0,.2,1);min-height:48px;font-family:inherit;box-shadow:0 4px 20px var(--gold-glow);letter-spacing:.5px}
.btn:active{transform:scale(.95);filter:brightness(.85)}
.btn-secondary{background:var(--glass);color:var(--text);border:1px solid var(--glass-border);box-shadow:none;backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px)}
.btn-secondary:active{background:rgba(255,255,255,.1)}
.btn-sm{padding:10px 18px;font-size:13px;border-radius:10px}
.btn:disabled{opacity:.35;cursor:not-allowed;box-shadow:none}

/* === GLASS EFFECT === */
.glass{background:var(--glass);backdrop-filter:blur(20px) saturate(1.2);-webkit-backdrop-filter:blur(20px) saturate(1.2);border:1px solid var(--glass-border);border-radius:16px}

/* ============ TITLE SCREEN ============ */
#title-screen{justify-content:center;align-items:center;background:radial-gradient(ellipse at 50% 40%,#1a1030 0%,#0f0a1a 50%,var(--bg1) 100%);padding:var(--safe-top) 0 var(--safe-bottom)}
#title-screen h1{font-size:56px;letter-spacing:12px;font-weight:700;background:linear-gradient(135deg,#f0c040 0%,#fff8e0 40%,#f0c040 60%,#d4912a 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;text-shadow:none;filter:drop-shadow(0 0 40px rgba(240,192,64,.4));margin-bottom:8px;animation:titleGlow 3s ease-in-out infinite}
#title-screen .subtitle{color:var(--text2);font-size:13px;margin-bottom:48px;letter-spacing:4px;font-weight:400}
#title-screen .version{position:absolute;bottom:calc(24px + var(--safe-bottom));color:var(--text3);font-size:11px;letter-spacing:1px}
@keyframes titleGlow{0%,100%{filter:drop-shadow(0 0 40px rgba(240,192,64,.3)) brightness(1)}50%{filter:drop-shadow(0 0 60px rgba(240,192,64,.5)) brightness(1.15)}}
.title-particles{position:absolute;width:100%;height:100%;overflow:hidden;pointer-events:none}
.title-particles span{position:absolute;width:2px;height:2px;background:var(--gold);border-radius:50%;animation:float-up linear infinite;opacity:0;box-shadow:0 0 6px var(--gold)}
@keyframes float-up{0%{transform:translateY(100vh) scale(0);opacity:0}15%{opacity:.7}80%{opacity:.3}100%{transform:translateY(-10vh) scale(1);opacity:0}}
.title-btn-group{display:flex;flex-direction:column;align-items:center;gap:14px}
.title-btn-group .btn{min-width:200px;animation:btnPulse 2.5s ease-in-out infinite}
@keyframes btnPulse{0%,100%{box-shadow:0 4px 20px var(--gold-glow)}50%{box-shadow:0 4px 40px rgba(240,192,64,.45)}}

/* ============ CLASS SELECT ============ */
#class-screen{background:linear-gradient(180deg,var(--bg1),var(--bg2));padding-top:var(--safe-top)}
.class-header{text-align:center;padding:24px 16px 16px;font-size:20px;font-weight:700;color:var(--gold);letter-spacing:2px}
.class-cards{display:flex;flex-direction:column;gap:14px;padding:0 16px;flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch;padding-bottom:20px}
.class-card{background:var(--glass);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-radius:18px;padding:18px;display:flex;gap:16px;align-items:center;border:2px solid var(--glass-border);transition:all .3s cubic-bezier(.4,0,.2,1);cursor:pointer}
.class-card:active,.class-card.selected{border-color:var(--gold);box-shadow:0 0 30px var(--gold-glow),inset 0 0 30px rgba(240,192,64,.05)}
.class-avatar{width:80px;height:100px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:40px;position:relative;overflow:hidden;box-shadow:0 4px 20px rgba(0,0,0,.4)}
.class-info{flex:1}
.class-info h3{font-size:18px;font-weight:700;margin-bottom:4px;color:var(--gold)}
.class-info p{font-size:12px;color:var(--text2);margin-bottom:8px;line-height:1.5}
.class-stats{display:flex;gap:8px;flex-wrap:wrap}
.class-stats span{font-size:11px;background:rgba(255,255,255,.06);padding:4px 10px;border-radius:8px;color:var(--text2);font-weight:700}
.class-select-btn{padding:16px;text-align:center}

/* ============ SKILL LOADOUT ============ */
#skill-screen{background:linear-gradient(180deg,var(--bg1),var(--bg2));padding-top:var(--safe-top)}
.skill-header{text-align:center;padding:20px 16px 12px;font-size:18px;font-weight:700;color:var(--gold);letter-spacing:1px}
.skill-section{padding:0 12px;margin-bottom:12px}
.skill-section h3{font-size:13px;color:var(--text2);margin-bottom:10px;padding-left:4px;font-weight:400;letter-spacing:.5px}
.skill-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:8px}
.skill-item{background:var(--glass);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border-radius:14px;padding:10px 4px;text-align:center;cursor:pointer;border:2px solid transparent;transition:all .25s cubic-bezier(.4,0,.2,1);min-height:72px;display:flex;flex-direction:column;align-items:center;justify-content:center}
.skill-item:active{transform:scale(.93)}
.skill-item.selected{border-color:var(--gold);box-shadow:0 0 20px var(--gold-glow);background:rgba(240,192,64,.08)}
.skill-item .icon{font-size:24px;margin-bottom:3px}
.skill-item .name{font-size:9px;line-height:1.2;color:var(--text2)}
.skill-desc-box{background:var(--glass);backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);border:1px solid var(--glass-border);border-radius:14px;padding:14px;margin:10px 12px;min-height:60px}
.skill-desc-box .title{color:var(--gold);font-size:15px;font-weight:700}
.skill-desc-box .desc{color:var(--text2);font-size:12px;margin-top:4px;line-height:1.5}
.skill-bottom{padding:12px 16px calc(12px + var(--safe-bottom));text-align:center;margin-top:auto}
.selected-count{font-size:12px;color:var(--text2);margin-bottom:8px}
.passive-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}

/* ============ MAIN SCREEN ============ */
#main-screen{background:linear-gradient(180deg,#0d0d1a 0%,#1a1030 50%,#0d0d1a 100%);padding-top:var(--safe-top)}

/* Top Bar */
.top-bar{display:flex;justify-content:space-between;align-items:center;padding:10px 16px;background:var(--glass);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-bottom:1px solid var(--glass-border);font-size:14px;font-weight:700}
.top-bar .level-badge{display:inline-flex;align-items:center;gap:4px;background:linear-gradient(135deg,var(--gold2),var(--gold));color:#111;padding:3px 10px;border-radius:20px;font-size:12px;font-weight:700;box-shadow:0 2px 10px var(--gold-glow)}
.top-bar .gold{color:var(--gold);display:flex;align-items:center;gap:4px;font-variant-numeric:tabular-nums}
.top-bar .points{color:var(--cyan);display:flex;align-items:center;gap:4px;font-variant-numeric:tabular-nums}
.currency-icon{font-size:16px}

/* Status Bars */
.status-bars{padding:10px 16px 6px}
.stat-bar{display:flex;align-items:center;gap:8px;margin-bottom:5px}
.stat-bar .label{font-size:14px;width:22px;text-align:center;flex-shrink:0}
.stat-bar .bar-bg{flex:1;height:14px;background:rgba(255,255,255,.06);border-radius:7px;overflow:hidden;position:relative}
.stat-bar .bar-fill{height:100%;border-radius:7px;transition:width .5s cubic-bezier(.4,0,.2,1);position:relative}
.stat-bar .bar-fill::after{content:'';position:absolute;top:0;left:0;right:0;height:50%;background:linear-gradient(180deg,rgba(255,255,255,.2),transparent);border-radius:7px 7px 0 0}
.stat-bar .bar-text{position:absolute;right:8px;top:50%;transform:translateY(-50%);font-size:10px;font-weight:700;text-shadow:0 1px 3px rgba(0,0,0,.8);font-variant-numeric:tabular-nums}
.bar-hp .bar-fill{background:linear-gradient(90deg,#cc2244,var(--hp))}
.bar-hunger .bar-fill{background:linear-gradient(90deg,#cc6600,var(--hunger))}
.bar-mood .bar-fill{background:linear-gradient(90deg,#0088cc,var(--mood))}
@keyframes shimmerBar{0%{background-position:-200% 0}100%{background-position:200% 0}}

/* Character Area */
.char-area{flex:1;display:flex;align-items:center;justify-content:center;position:relative;min-height:200px}
.char-area::before{content:'';position:absolute;width:200px;height:200px;border-radius:50%;background:radial-gradient(circle,var(--gold-glow) 0%,transparent 70%);top:50%;left:50%;transform:translate(-50%,-50%);animation:charAreaGlow 4s ease-in-out infinite;pointer-events:none}
@keyframes charAreaGlow{0%,100%{opacity:.4;transform:translate(-50%,-50%) scale(1)}50%{opacity:.7;transform:translate(-50%,-50%) scale(1.1)}}
.character{position:relative;animation:charIdle 3s ease-in-out infinite}
@keyframes charIdle{0%,100%{transform:translateY(0) scale(1)}50%{transform:translateY(-10px) scale(1.02)}}
.char-body{width:120px;height:160px;border-radius:24px 24px 32px 32px;position:relative;display:flex;flex-direction:column;align-items:center;justify-content:center;box-shadow:0 10px 50px rgba(0,0,0,.6),0 0 40px rgba(0,0,0,.3)}
.char-face{position:relative;width:60px;height:40px;margin-top:-10px}
.char-eyes{display:flex;gap:16px;justify-content:center}
.char-eye{width:10px;height:12px;background:#fff;border-radius:50%;position:relative;box-shadow:0 0 8px rgba(255,255,255,.3)}
.char-eye::after{content:'';position:absolute;width:6px;height:6px;background:#111;border-radius:50%;bottom:2px;left:2px}
.char-mouth{width:16px;height:8px;border-bottom:3px solid #fff;border-radius:0 0 8px 8px;margin:6px auto 0;transition:all .3s}
.char-mouth.happy{border-bottom-color:var(--success);width:20px}
.char-mouth.sad{border-top:3px solid #fff;border-bottom:none;border-radius:8px 8px 0 0;width:14px}
.char-mouth.angry{border-bottom-color:var(--danger);width:12px;height:4px}
.char-weapon{position:absolute;right:-32px;top:38%;font-size:30px;animation:weaponBob 3s ease-in-out infinite .5s;filter:drop-shadow(0 2px 8px rgba(0,0,0,.5))}
@keyframes weaponBob{0%,100%{transform:rotate(-5deg) translateY(0)}50%{transform:rotate(5deg) translateY(-4px)}}
.char-glow{position:absolute;width:180px;height:180px;border-radius:50%;top:50%;left:50%;transform:translate(-50%,-50%);filter:blur(50px);opacity:.25;z-index:-1}
/* Sparkle particles around character */
.char-sparkles{position:absolute;width:200px;height:200px;top:50%;left:50%;transform:translate(-50%,-50%);pointer-events:none}
.char-sparkles span{position:absolute;width:3px;height:3px;background:var(--gold);border-radius:50%;animation:sparkle 2s ease-in-out infinite;opacity:0;box-shadow:0 0 4px var(--gold)}
@keyframes sparkle{0%,100%{opacity:0;transform:scale(0)}50%{opacity:.8;transform:scale(1)}}

/* Equipment Row */
.equip-row{display:flex;justify-content:center;gap:10px;padding:8px 16px}
.equip-slot{width:50px;height:50px;background:var(--glass);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border-radius:12px;border:2px solid var(--glass-border);display:flex;align-items:center;justify-content:center;font-size:22px;cursor:pointer;position:relative;transition:all .25s cubic-bezier(.4,0,.2,1)}
.equip-slot:active{transform:scale(.92)}
.equip-slot.has-item{border-color:var(--gold);box-shadow:0 0 15px var(--gold-glow)}

/* Skill Row */
.skill-equip-row{display:flex;justify-content:center;gap:8px;padding:4px 16px 8px}
.skill-slot{width:44px;height:44px;background:var(--glass);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);border-radius:22px;border:1.5px solid rgba(155,89,182,.3);display:flex;align-items:center;justify-content:center;font-size:20px;box-shadow:0 0 12px rgba(155,89,182,.1);animation:skillPulse 3s ease-in-out infinite}
@keyframes skillPulse{0%,100%{box-shadow:0 0 12px rgba(155,89,182,.1)}50%{box-shadow:0 0 20px rgba(155,89,182,.25)}}

/* Bottom Navigation */
.bottom-menu{display:grid;grid-template-columns:repeat(5,1fr);gap:6px;padding:8px 12px;padding-bottom:var(--safe-bottom);background:var(--glass);backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);border-top:1px solid var(--glass-border);margin:0 8px 8px;border-radius:20px;box-shadow:0 -4px 30px rgba(0,0,0,.3)}
.menu-btn{background:transparent;border:none;border-radius:14px;padding:8px 4px;color:var(--text2);display:flex;flex-direction:column;align-items:center;gap:3px;cursor:pointer;transition:all .2s cubic-bezier(.4,0,.2,1);min-height:52px;justify-content:center}
.menu-btn:active{transform:scale(.9);color:var(--gold);background:rgba(240,192,64,.08)}
.menu-btn .icon{font-size:22px;transition:transform .2s}
.menu-btn:active .icon{transform:scale(1.15)}
.menu-btn .label{font-size:10px;font-weight:700;letter-spacing:.3px}

/* ============ OVERLAYS ============ */
.overlay{display:none;position:absolute;top:0;left:0;width:100%;height:100%;background:linear-gradient(180deg,rgba(10,10,15,.97),rgba(26,16,37,.97));z-index:100;flex-direction:column;backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px)}
.overlay.active{display:flex;animation:overlayIn .3s cubic-bezier(.4,0,.2,1)}
@keyframes overlayIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
.overlay-header{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;padding-top:calc(14px + var(--safe-top));border-bottom:1px solid var(--glass-border);background:var(--glass);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px)}
.overlay-header h2{font-size:17px;color:var(--gold);font-weight:700;letter-spacing:.5px}
.close-btn{background:var(--glass);border:1px solid var(--glass-border);color:var(--text2);font-size:18px;cursor:pointer;width:36px;height:36px;display:flex;align-items:center;justify-content:center;border-radius:12px;transition:all .2s}
.close-btn:active{background:rgba(255,255,255,.1);transform:scale(.9)}
.overlay-body{flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch;padding:16px;padding-bottom:var(--safe-bottom)}

/* ============ HUNT ============ */
.hunt-status-bar{padding:8px 16px;display:flex;gap:10px;flex-wrap:wrap;font-size:12px;background:var(--glass);border-bottom:1px solid var(--glass-border);font-weight:700;font-variant-numeric:tabular-nums}
.hunt-status-bar span{display:flex;align-items:center;gap:3px}
.hunt-log{display:flex;flex-direction:column;gap:6px}
.hunt-line{opacity:0;animation:huntLineIn .4s cubic-bezier(.4,0,.2,1) forwards;font-size:14px;line-height:1.7;padding:6px 12px;border-radius:10px;background:rgba(255,255,255,.02)}
@keyframes huntLineIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.hunt-line.story{color:var(--text2);font-style:italic;background:none}
.hunt-line.action{color:var(--gold);background:rgba(240,192,64,.05)}
.hunt-line.damage{color:var(--danger);background:rgba(255,68,102,.05)}
.hunt-line.heal{color:var(--success);background:rgba(0,232,143,.05)}
.hunt-line.loot{color:var(--cyan);font-weight:700;background:rgba(0,212,255,.06)}
.hunt-line.boss{color:var(--orange);font-size:16px;font-weight:700;background:rgba(249,115,22,.08)}
.hunt-line.victory{color:var(--success);font-size:16px;font-weight:700;text-align:center;background:rgba(0,232,143,.08)}
.hunt-controls{padding:12px 16px calc(12px + var(--safe-bottom));display:flex;gap:10px;justify-content:center}
.sc-wrap{display:flex;flex-direction:column;align-items:center;gap:12px;padding:16px;background:var(--glass);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border-radius:16px;margin:8px 0;border:1px solid var(--glass-border)}
.sc-gauge{position:relative;width:180px;height:180px}
.sc-gauge svg{width:100%;height:100%;filter:drop-shadow(0 0 8px rgba(240,192,64,.2))}
.sc-btn{padding:14px 36px;background:linear-gradient(135deg,var(--gold),var(--accent));color:#000;border:none;border-radius:14px;font-size:16px;font-weight:700;cursor:pointer;font-family:inherit;box-shadow:0 4px 20px var(--gold-glow);transition:all .2s}
.sc-btn:active{transform:scale(.95)}
.sc-btn:disabled{opacity:.4;cursor:not-allowed;box-shadow:none}
.sc-info{display:flex;gap:16px;font-size:13px;color:var(--text2)}
.sc-info b{color:var(--text)}
.sc-result{font-size:14px;font-weight:700;min-height:20px}
.auto-hunt-badge{background:var(--success);color:#000;padding:3px 10px;border-radius:10px;font-size:11px;font-weight:700;box-shadow:0 0 12px rgba(0,232,143,.3);animation:autoHuntPulse 1.5s ease-in-out infinite}
@keyframes autoHuntPulse{0%,100%{box-shadow:0 0 12px rgba(0,232,143,.3)}50%{box-shadow:0 0 20px rgba(0,232,143,.5)}}

/* ============ INVENTORY ============ */
.inv-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:8px}
.inv-slot{aspect-ratio:1;background:var(--glass);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);border-radius:12px;border:2px solid var(--glass-border);display:flex;align-items:center;justify-content:center;font-size:22px;cursor:pointer;position:relative;transition:all .2s cubic-bezier(.4,0,.2,1)}
.inv-slot:active{transform:scale(.92)}
.inv-slot.grade-ÏùºÎ∞ò{border-color:rgba(150,150,150,.3);box-shadow:0 0 8px rgba(150,150,150,.1)}
.inv-slot.grade-Î†àÏñ¥{border-color:rgba(74,158,255,.35);box-shadow:0 0 12px rgba(74,158,255,.15)}
.inv-slot.grade-Ïú†ÎãàÌÅ¨{border-color:rgba(168,85,247,.35);box-shadow:0 0 12px rgba(168,85,247,.2)}
.inv-slot.grade-ÏóêÌîΩ{border-color:rgba(249,115,22,.4);box-shadow:0 0 16px rgba(249,115,22,.25)}
.inv-slot .dur-bar{position:absolute;bottom:3px;left:5px;right:5px;height:3px;background:rgba(255,255,255,.08);border-radius:2px}
.inv-slot .dur-fill{height:100%;background:var(--success);border-radius:2px;transition:width .3s}

/* Item Detail */
.item-detail{background:var(--glass);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border:1px solid var(--glass-border);border-radius:18px;padding:20px;margin-bottom:16px}
.item-detail .item-name{font-size:18px;font-weight:700;margin-bottom:4px}
.item-detail .item-grade{font-size:12px;margin-bottom:10px;font-weight:700}
.item-detail .item-stats{margin-bottom:10px}
.item-detail .item-stats div{font-size:13px;color:var(--text2);padding:3px 0;display:flex;align-items:center;gap:6px}
.item-detail .item-desc{font-size:12px;color:var(--text2);font-style:italic;border-top:1px solid var(--glass-border);padding-top:10px;margin-top:10px;line-height:1.6}
.item-detail .item-actions{display:flex;gap:8px;margin-top:14px;flex-wrap:wrap}
.grade-ÏùºÎ∞ò-text{color:#999}
.grade-Î†àÏñ¥-text{color:var(--blue)}
.grade-Ïú†ÎãàÌÅ¨-text{color:var(--purple)}
.grade-ÏóêÌîΩ-text{color:var(--orange)}

/* ============ SHOP ============ */
.shop-tabs{display:flex;gap:0;padding:0 16px 14px;position:relative}
.shop-tab{flex:1;padding:12px;text-align:center;background:var(--glass);border:none;color:var(--text2);cursor:pointer;font-size:13px;font-weight:700;transition:all .25s;font-family:inherit}
.shop-tab:first-child{border-radius:10px 0 0 10px}
.shop-tab:last-child{border-radius:0 10px 10px 0}
.shop-tab.active{background:linear-gradient(135deg,var(--gold2),var(--gold));color:#111}
.shop-items{display:flex;flex-direction:column;gap:10px}
.shop-item{background:var(--glass);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border:1px solid var(--glass-border);border-radius:14px;padding:14px 16px;display:flex;align-items:center;gap:14px;cursor:pointer;transition:all .2s}
.shop-item:active{background:rgba(255,255,255,.08);transform:scale(.98)}
.shop-item .s-icon{font-size:30px;width:44px;text-align:center}
.shop-item .s-info{flex:1}
.shop-item .s-name{font-size:14px;font-weight:700}
.shop-item .s-desc{font-size:11px;color:var(--text2);margin-top:2px}
.shop-item .s-price{font-size:14px;font-weight:700;color:var(--gold);font-variant-numeric:tabular-nums}

/* ============ MISSIONS ============ */
.mission-card{background:var(--glass);backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);border:1px solid var(--glass-border);border-radius:18px;padding:18px;margin-bottom:14px;position:relative;overflow:hidden}
.mission-card .npc-row{display:flex;gap:14px;align-items:center;margin-bottom:10px}
.mission-card .npc-avatar{width:50px;height:50px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:24px;box-shadow:0 4px 16px rgba(0,0,0,.4)}
.mission-card .npc-name{font-size:15px;font-weight:700;color:var(--gold)}
.mission-card .npc-dialogue{font-size:13px;color:var(--text2);font-style:italic;margin-bottom:14px;line-height:1.6;background:rgba(255,255,255,.03);padding:10px 14px;border-radius:12px;border-left:3px solid var(--glass-border)}
.mission-card .mission-reward{font-size:12px;color:var(--success);margin-bottom:10px;font-weight:700}
.mission-card .cpq-badge{position:absolute;top:14px;right:14px;background:linear-gradient(135deg,var(--accent),#7c3aed);color:#fff;padding:3px 10px;border-radius:8px;font-size:10px;font-weight:700;letter-spacing:.5px;box-shadow:0 2px 10px rgba(155,89,182,.3)}
.mission-card .cooldown{color:var(--text2);font-size:12px;text-align:center;padding:10px;background:rgba(255,255,255,.03);border-radius:10px}

/* ============ SKILL MANAGE ============ */
.skill-manage-item{background:var(--glass);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border:1px solid var(--glass-border);border-radius:14px;padding:14px;margin-bottom:10px;display:flex;gap:14px;align-items:center;cursor:pointer;border:2px solid transparent;transition:all .25s cubic-bezier(.4,0,.2,1)}
.skill-manage-item:active{transform:scale(.97)}
.skill-manage-item.equipped{border-color:var(--gold);box-shadow:0 0 20px var(--gold-glow);background:rgba(240,192,64,.05)}
.skill-manage-item .sk-icon{font-size:28px;width:44px;text-align:center}
.skill-manage-item .sk-info{flex:1}
.skill-manage-item .sk-name{font-size:14px;font-weight:700}
.skill-manage-item .sk-desc{font-size:11px;color:var(--text2);margin-top:2px}

/* ============ LEVEL UP ============ */
.levelup-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100dvh;background:rgba(10,10,15,.95);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);z-index:200;flex-direction:column;align-items:center;justify-content:center}
.levelup-overlay.active{display:flex;animation:levelUpFlash .5s}
@keyframes levelUpFlash{0%{background:rgba(240,192,64,.3)}30%{background:rgba(240,192,64,.1)}100%{background:rgba(10,10,15,.95)}}
.levelup-title{font-size:36px;color:var(--gold);font-weight:700;margin-bottom:8px;animation:levelUpScale .6s cubic-bezier(.17,.67,.35,1.5);filter:drop-shadow(0 0 30px var(--gold-glow))}
@keyframes levelUpScale{0%{transform:scale(0);opacity:0}100%{transform:scale(1);opacity:1}}
.levelup-sub{color:var(--text2);font-size:14px;margin-bottom:24px}
.levelup-choices{display:flex;flex-direction:column;gap:12px;width:85%;max-width:320px}
.levelup-choice{background:var(--glass);backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);border:2px solid rgba(240,192,64,.2);border-radius:16px;padding:18px;text-align:center;cursor:pointer;transition:all .25s cubic-bezier(.4,0,.2,1);animation:choiceSlideIn .4s cubic-bezier(.4,0,.2,1) both}
.levelup-choice:nth-child(1){animation-delay:.1s}
.levelup-choice:nth-child(2){animation-delay:.2s}
.levelup-choice:nth-child(3){animation-delay:.3s}
@keyframes choiceSlideIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
.levelup-choice:active{transform:scale(.95);border-color:var(--gold);box-shadow:0 0 25px var(--gold-glow)}
.levelup-choice .lc-name{font-size:16px;font-weight:700;color:var(--gold);margin-bottom:4px}
.levelup-choice .lc-desc{font-size:12px;color:var(--text2)}
.auto-levelup-toggle{display:flex;align-items:center;justify-content:center;gap:10px;cursor:pointer;font-size:13px;color:var(--text2);margin-bottom:12px}
.auto-levelup-toggle input{width:20px;height:20px;accent-color:var(--gold);border-radius:6px}

/* ============ PARTICLES ============ */
.particles{position:absolute;width:100%;height:100%;pointer-events:none;overflow:hidden;z-index:150}
.particle{position:absolute;border-radius:50%;animation:particleUp 1s ease-out forwards}
@keyframes particleUp{0%{opacity:1;transform:translateY(0) scale(1)}100%{opacity:0;transform:translateY(-80px) scale(0)}}

/* ============ TOAST ============ */
.toast{position:fixed;top:calc(60px + var(--safe-top));left:50%;transform:translateX(-50%);background:var(--glass);backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);border:1px solid var(--glass-border);color:var(--text);padding:12px 24px;border-radius:14px;font-size:13px;font-weight:700;z-index:300;animation:toastIn .35s cubic-bezier(.4,0,.2,1),toastOut .35s 2s forwards;white-space:nowrap;box-shadow:0 8px 32px rgba(0,0,0,.4)}
@keyframes toastIn{from{opacity:0;transform:translateX(-50%) translateY(-16px) scale(.95)}to{opacity:1;transform:translateX(-50%) translateY(0) scale(1)}}
@keyframes toastOut{to{opacity:0;transform:translateX(-50%) translateY(-16px) scale(.95)}}

/* ============ SCROLLBAR ============ */
::-webkit-scrollbar{width:3px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:rgba(255,255,255,.1);border-radius:3px}
</style>
</head>
<body>

<!-- TITLE SCREEN -->
<div id="title-screen" class="screen active">
<div class="title-particles" id="title-particles"></div>
<h1>SYMMETRY</h1>
<div class="subtitle">AI ÌÇ§Ïö∞Í∏∞ RPG</div>
<div class="title-btn-group">
<button class="btn" onclick="showScreen('class-screen')">ÏãúÏûëÌïòÍ∏∞</button>
<button class="btn btn-secondary btn-sm" onclick="loadGame()">Ïù¥Ïñ¥ÌïòÍ∏∞</button>
</div>
<div class="version">v1.0</div>
</div>

<!-- CLASS SELECT -->
<div id="class-screen" class="screen">
<div class="class-header">‚öîÔ∏è ÏßÅÏóÖÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</div>
<div class="class-cards" id="class-cards"></div>
<div class="class-select-btn"><button class="btn" onclick="confirmClass()" id="class-confirm-btn" disabled>ÏÑ†ÌÉù ÏôÑÎ£å</button></div>
</div>

<!-- SKILL LOADOUT -->
<div id="skill-screen" class="screen">
<div class="skill-header">‚ú® Ïä§ÌÇ¨ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</div>
<div style="flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch">
<div class="skill-section"><h3>üó°Ô∏è Ïï°Ìã∞Î∏å Ïä§ÌÇ¨ (3Í∞ú ÏÑ†ÌÉù)</h3><div class="skill-grid" id="active-skill-grid"></div></div>
<div class="skill-desc-box" id="skill-desc-box"><div class="title">Ïä§ÌÇ¨ÏùÑ ÌÑ∞ÏπòÌïòÏÑ∏Ïöî</div><div class="desc">ÏÑ§Î™ÖÏù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§</div></div>
<div class="selected-count" id="active-count">ÏÑ†ÌÉù: 0/3</div>
<div class="skill-section"><h3>üõ°Ô∏è Ìå®ÏãúÎ∏å Ïä§ÌÇ¨ (2Í∞ú ÏÑ†ÌÉù)</h3><div class="passive-grid" id="passive-skill-grid"></div></div>
<div class="selected-count" id="passive-count">ÏÑ†ÌÉù: 0/2</div>
</div>
<div class="skill-bottom"><button class="btn" onclick="confirmSkills()" id="skill-confirm-btn" disabled>Ï∂úÎ∞ú!</button></div>
</div>

<!-- MAIN SCREEN -->
<div id="main-screen" class="screen">
<div class="top-bar">
<span class="level-badge">‚≠ê Lv.<span id="player-level">1</span></span>
<span class="gold"><span class="currency-icon">üí∞</span> <span id="player-gold">100</span></span>
<span class="points"><span class="currency-icon">üíé</span> <span id="player-points">10</span></span>
</div>
<div class="status-bars">
<div class="stat-bar bar-hp"><span class="label">‚ù§Ô∏è</span><div class="bar-bg"><div class="bar-fill" id="hp-bar" style="width:100%"></div><span class="bar-text" id="hp-text">100/100</span></div></div>
<div class="stat-bar bar-hunger"><span class="label">üçñ</span><div class="bar-bg"><div class="bar-fill" id="hunger-bar" style="width:100%"></div><span class="bar-text" id="hunger-text">100%</span></div></div>
<div class="stat-bar bar-mood"><span class="label">‚ö°</span><div class="bar-bg"><div class="bar-fill" id="mood-bar" style="width:80%"></div><span class="bar-text" id="mood-text">80%</span></div></div>
</div>
<div class="char-area" id="char-area"></div>
<div class="equip-row" id="equip-row">
<div class="equip-slot" onclick="openOverlay('inventory','weapon')" title="Î¨¥Í∏∞">‚öîÔ∏è</div>
<div class="equip-slot" onclick="openOverlay('inventory','armor')" title="Î∞©Ïñ¥Íµ¨">üõ°Ô∏è</div>
<div class="equip-slot" onclick="openOverlay('inventory','accessory')" title="Ïû•Ïã†Íµ¨">üìø</div>
</div>
<div class="skill-equip-row" id="skill-equip-row"></div>
<div class="bottom-menu">
<button class="menu-btn" onclick="openOverlay('hunt')"><span class="icon">‚öîÔ∏è</span><span class="label">ÏÇ¨ÎÉ•</span></button>
<button class="menu-btn" onclick="openOverlay('mission')"><span class="icon">üìã</span><span class="label">ÎØ∏ÏÖò</span></button>
<button class="menu-btn" onclick="openOverlay('shop')"><span class="icon">üè™</span><span class="label">ÏÉÅÏ†ê</span></button>
<button class="menu-btn" onclick="openOverlay('inventory')"><span class="icon">üéí</span><span class="label">Ïû•ÎπÑ</span></button>
<button class="menu-btn" onclick="openOverlay('skills')"><span class="icon">‚ú®</span><span class="label">Ïä§ÌÇ¨</span></button>
</div>
</div>

<!-- OVERLAYS -->
<div class="overlay" id="overlay-hunt">
<div class="overlay-header"><h2>‚öîÔ∏è ÏÇ¨ÎÉ• ‚Äî <span id="hunt-floor">1</span>Ï∏µ</h2><div style="display:flex;gap:8px;align-items:center"><span id="auto-hunt-indicator"></span><button class="close-btn" onclick="closeOverlay('hunt')">‚úï</button></div></div>
<div class="hunt-status-bar">
<span>‚ù§Ô∏è <span id="hunt-hp" style="color:var(--danger)">100/100</span></span>
<span>üçñ <span id="hunt-hunger" style="color:var(--hunger)">100%</span></span>
<span>‚ö° <span id="hunt-mood" style="color:var(--cyan)">100%</span></span>
<span>‚≠ê Lv.<span id="hunt-level">1</span></span>
<span>üí∞ <span id="hunt-gold">0</span></span>
</div>
<div class="overlay-body"><div class="hunt-log" id="hunt-log"></div></div>
<div class="hunt-controls">
<button class="btn" onclick="startHunt()" id="hunt-btn">üó°Ô∏è ÏÇ¨ÎÉ• ÏãúÏûë</button>
<button class="btn btn-secondary" onclick="toggleAutoHunt()" id="auto-hunt-btn">üîÑ ÏûêÎèôÏÇ¨ÎÉ•</button>
</div>
</div>

<div class="overlay" id="overlay-mission">
<div class="overlay-header"><h2>üìã ÎØ∏ÏÖò Í≤åÏãúÌåê</h2><button class="close-btn" onclick="closeOverlay('mission')">‚úï</button></div>
<div class="overlay-body" id="mission-body"></div>
</div>

<div class="overlay" id="overlay-shop">
<div class="overlay-header"><h2>üè™ ÏÉÅÏ†ê</h2><button class="close-btn" onclick="closeOverlay('shop')">‚úï</button></div>
<div class="overlay-body">
<div class="shop-tabs"><button class="shop-tab active" onclick="switchShopTab('gold',this)">üí∞ Í≥®Îìú ÏÉÅÏ†ê</button><button class="shop-tab" onclick="switchShopTab('point',this)">üíé Ìè¨Ïù∏Ìä∏ ÏÉÅÏ†ê</button></div>
<div class="shop-items" id="shop-items"></div>
</div>
</div>

<div class="overlay" id="overlay-inventory">
<div class="overlay-header"><h2>üéí Ïû•ÎπÑ</h2><button class="close-btn" onclick="closeOverlay('inventory')">‚úï</button></div>
<div class="overlay-body">
<div id="item-detail-area"></div>
<div class="inv-grid" id="inv-grid"></div>
</div>
</div>

<div class="overlay" id="overlay-skills">
<div class="overlay-header"><h2>‚ú® Ïä§ÌÇ¨ Í¥ÄÎ¶¨</h2><button class="close-btn" onclick="closeOverlay('skills')">‚úï</button></div>
<div class="overlay-body" id="skills-body"></div>
</div>

<!-- LEVEL UP -->
<div class="levelup-overlay" id="levelup-overlay">
<div class="particles" id="levelup-particles"></div>
<div class="levelup-title">üéâ Î†àÎ≤® ÏóÖ!</div>
<div class="levelup-sub" id="levelup-sub">Lv.2 Îã¨ÏÑ±!</div>
<div style="color:var(--text2);font-size:12px;margin-bottom:8px">Î≥¥ÏÉÅÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</div>
<div class="auto-levelup-toggle"><label style="display:flex;align-items:center;gap:8px;cursor:pointer"><input type="checkbox" id="auto-levelup-toggle" onchange="G.autoLevelUp=this.checked;saveGame()"> ü§ñ ÏûêÎèô ÏÑ†ÌÉù</label></div>
<div class="levelup-choices" id="levelup-choices"></div>
</div>

<script>
// ===== GAME DATA =====
const CLASSES={
Í±∞ÎÑà:{color:'#22c55e',glow:'#22c55e',weapon:'üî´',bodyColor:'linear-gradient(180deg,#1a5c2a,#0f3d1a)',desc:'ÏõêÍ±∞Î¶¨ ÎîúÎü¨. Ï¥ùÍ≥º Ìè≠Î∞úÎ¨ºÎ°ú Ï†ÅÏùÑ ÏÑ¨Î©∏ÌïúÎã§.',baseHP:90,baseATK:18,baseDEF:6,
skills:[
{name:'ÏÉ∑Í±¥',icon:'üí•',desc:'Í∑ºÍ±∞Î¶¨ ÏÇ∞ÌÉÑ ‚Äî ÎÜíÏùÄ Îç∞ÎØ∏ÏßÄ',dmg:30},
{name:'Í∏∞Í¥ÄÏ¥ù',icon:'üî´',desc:'Ïó∞ÏÇ¨ Í≥µÍ≤© ‚Äî Îã§Ï§ë ÌÉÄÍ≤©',dmg:12,hits:3},
{name:'ÏàòÎ•òÌÉÑ',icon:'üí£',desc:'AoE Ìè≠Î∞ú ‚Äî Í¥ëÏó≠ Îç∞ÎØ∏ÏßÄ',dmg:22,aoe:true},
{name:'Ïä§ÌåÄÌå©',icon:'üíâ',desc:'Í≥µÏÜç Î≤ÑÌîÑ ‚Äî ATK +30%',buff:true,dmg:0},
{name:'Îü¨ÏãúÏïàÎ£∞Î†õ',icon:'üé∞',desc:'HP 30% Ïù¥Ìïò Ïãú Ìè≠Îîú',dmg:50},
{name:'ÎÑ§Ïù¥ÌåúÌÉÑ',icon:'üî•',desc:'ÏßÄÏÜç ÌôîÏóº ‚Äî DoT Îç∞ÎØ∏ÏßÄ',dmg:15,dot:true},
{name:'Í¥ÄÌÜµÌÉÑ',icon:'üéØ',desc:'Í¥ÄÌÜµ ÏÇ¨Í≤© ‚Äî Î∞©Ïñ¥ Î¨¥Ïãú',dmg:28},
{name:'ÏÇ∞ÌÉÑÌè≠Ìíç',icon:'üå™Ô∏è',desc:'360ÎèÑ Ï†ÑÏ≤¥ Í≥µÍ≤©',dmg:20,aoe:true},
{name:'ÎìúÎ°†Ìè¨Í≤©',icon:'ü§ñ',desc:'ÏûêÎèô ÎìúÎ°† ÏÜåÌôò Í≥µÍ≤©',dmg:18},
{name:'Ï†ÄÍ≤©',icon:'üî≠',desc:'ÏõêÍ±∞Î¶¨ Ï¥àÍ≥†Îç∞ÎØ∏ÏßÄ Îã®Ïùº ÌÉÄÍ≤©',dmg:45}],
passives:[
{name:'ÏπòÎ™ÖÌÉÄ +15%',icon:'üíÄ',desc:'ÏπòÎ™ÖÌÉÄ ÌôïÎ•† 15% Ï¶ùÍ∞Ä'},
{name:'Ïø®ÌÉÄÏûÑ -20%',icon:'‚è±Ô∏è',desc:'Ïä§ÌÇ¨ Ïø®ÌÉÄÏûÑ 20% Í∞êÏÜå'},
{name:'50% ÎëêÎ∞ú ÏãúÏ†Ñ',icon:'üé≤',desc:'50% ÌôïÎ•†Î°ú Ïä§ÌÇ¨ 2Ìöå ÏãúÏ†Ñ'},
{name:'AoE +30%',icon:'üí´',desc:'Í¥ëÏó≠ Ïä§ÌÇ¨ Î≤îÏúÑ 30% Ï¶ùÍ∞Ä'},
{name:'Îî∏Ìîº Ï†Å +50%',icon:'‚ò†Ô∏è',desc:'HP ÎÇÆÏùÄ Ï†ÅÏóêÍ≤å 50% Ï∂îÍ∞Ä Îç∞ÎØ∏ÏßÄ'},
{name:'5ÌÉÄ Ï∂îÍ∞ÄÌÉÑ',icon:'üîÑ',desc:'5Î≤àÏß∏ Í≥µÍ≤©ÎßàÎã§ Ï∂îÍ∞ÄÌÉÑ Î∞úÏÇ¨'}]},
ÎßàÎ≤ïÏÇ¨:{color:'#4a9eff',glow:'#4a9eff',weapon:'ü™Ñ',bodyColor:'linear-gradient(180deg,#1a3a6c,#0f1f3d)',desc:'ÎßàÎ≤ï ÎîúÎü¨. ÏõêÏÜå ÎßàÎ≤ïÏúºÎ°ú Ï†ÑÏû•ÏùÑ ÏßÄÎ∞∞ÌïúÎã§.',baseHP:80,baseATK:22,baseDEF:5,
skills:[
{name:'ÌååÏù¥Ïñ¥Î≥º',icon:'üî•',desc:'ÌôîÏóº Ìè≠Î∞ú ‚Äî Îã®Ïùº Í≥†Îç∞ÎØ∏ÏßÄ',dmg:28},
{name:'ÏïÑÏù¥Ïä§ÎÖ∏Î∞î',icon:'‚ùÑÔ∏è',desc:'AoE ÎπôÍ≤∞ ‚Äî Í¥ëÏó≠+ÎëîÌôî',dmg:20,aoe:true},
{name:'ÏûÖÏûêÏôÄ ÌååÎèô',icon:'‚öõÔ∏è',desc:'50/50 Îã®Ïùº ÎòêÎäî Î≤îÏúÑ Í≥µÍ≤©',dmg:25},
{name:'Î∏îÎ†àÏù¥Ï¶à',icon:'üî•',desc:'ÌôîÏóº ÏûêÏ∑® ‚Äî ÏßÄÏÜç Îç∞ÎØ∏ÏßÄ',dmg:15,dot:true},
{name:'ÏÇ¨Í±¥Ïùò ÏßÄÌèâÏÑ†',icon:'üåÄ',desc:'Ï§ëÎ†•Ïû• ‚Äî Ï†Å ÏÜçÎ∞ï',dmg:18},
{name:'ÏñºÏùåÎ∞©Ìå®',icon:'üßä',desc:'5Ï¥à Î¨¥Ï†Å ‚Äî Î∞©Ïñ¥ Ïä§ÌÇ¨',buff:true,dmg:0},
{name:'Ï≤¥Ïù∏ÎùºÏù¥Ìä∏Îãù',icon:'‚ö°',desc:'5Ïó∞ÏáÑ Î≤àÍ∞ú Í≥µÍ≤©',dmg:14,hits:5},
{name:'Î©îÌÖåÏò§',icon:'‚òÑÔ∏è',desc:'ÎåÄÌòï AoE ‚Äî ÏµúÍ∞ï Í¥ëÏó≠Í∏∞',dmg:35,aoe:true},
{name:'ÌÖîÎ†àÌè¨Ìä∏',icon:'‚ú®',desc:'ÏàúÍ∞ÑÏù¥Îèô + Îç∞ÎØ∏ÏßÄ',dmg:20},
{name:'ÎßàÎÇòÌè≠Î∞ú',icon:'üíú',desc:'HP Ìù¨ÏÉù Ìè≠Îîú ‚Äî Í≥†ÏúÑÌóò Í≥†Î≥¥ÏÉÅ',dmg:55}],
passives:[
{name:'ÎπôÍ≤∞ ÏñºÏùåÌôîÏÇ¥',icon:'üèπ',desc:'ÎπôÍ≤∞Îêú Ï†ÅÏóêÍ≤å Ï∂îÍ∞Ä ÏñºÏùåÌôîÏÇ¥'},
{name:'Ïø®ÌÉÄÏûÑ -50%',icon:'‚è±Ô∏è',desc:'Ïä§ÌÇ¨ Ïø®ÌÉÄÏûÑ 50% ÎåÄÌè≠ Í∞êÏÜå'},
{name:'Î∂àÌÉÄÎäî Ï†Å +30%',icon:'üî•',desc:'ÌôîÏÉÅ ÏÉÅÌÉú Ï†ÅÏóêÍ≤å 30% Ï∂îÍ∞Ä Îç∞ÎØ∏ÏßÄ'},
{name:'ÌÇ¨ ÌõÑ Î¨¥ÏÜåÎπÑ',icon:'üíÄ',desc:'ÌÇ¨ ÌõÑ 3Ï¥àÍ∞Ñ ÎßàÎÇò ÏÜåÎπÑ ÏóÜÏùå'},
{name:'2ÏÜçÏÑ± Ìè≠Î∞ú',icon:'üí•',desc:'2Í∞ÄÏßÄ ÏÜçÏÑ± Ïó∞ÏÜç ÌûàÌä∏ Ïãú Î≥¥ÎÑàÏä§ Ìè≠Î∞ú'},
{name:'Ïó∞ÏáÑÌè≠Î∞ú 30%',icon:'üîó',desc:'AoE ÌÇ¨ Ïãú 30% ÌôïÎ•† Ïó∞ÏáÑÌè≠Î∞ú'}]},
Ï†ÑÏÇ¨:{color:'#ef4444',glow:'#ef4444',weapon:'‚öîÔ∏è',bodyColor:'linear-gradient(180deg,#6c1a1a,#3d0f0f)',desc:'Í∑ºÏ†ë ÌÉ±Ïª§/ÎîúÎü¨. Í∞ïÏù∏Ìïú Î∞©Ïñ¥ÏôÄ Í∞ïÎ†•Ìïú Í∑ºÏ†ë Í≥µÍ≤©.',baseHP:120,baseATK:15,baseDEF:10,
skills:[
{name:'Í≤ÄÍ∏∞',icon:'üó°Ô∏è',desc:'ÏõêÍ±∞Î¶¨ Í≤ÄÌåå ‚Äî Ï§ëÍ±∞Î¶¨ Í≥µÍ≤©',dmg:24},
{name:'ÏπºÎÇ† Î≥µÏ†ú',icon:'üë•',desc:'Î∂ÑÏã† Í≥µÍ≤© ‚Äî 2Ìöå ÌÉÄÍ≤©',dmg:16,hits:2},
{name:'Ìú†ÏúàÎìú',icon:'üåÄ',desc:'ÌöåÏ†Ñ Í≥µÍ≤© ‚Äî Í¥ëÏó≠ Îç∞ÎØ∏ÏßÄ',dmg:22,aoe:true},
{name:'ÌöåÏ†ÑÏπºÎÇ†',icon:'üí´',desc:'Í∂§ÎèÑ ÏπºÎÇ† ‚Äî ÏßÄÏÜç Îç∞ÎØ∏ÏßÄ',dmg:14,dot:true},
{name:'Ïä§ÌÜ∞ÌîÑ',icon:'ü¶∂',desc:'Ïä§ÌÑ¥ ‚Äî Ï†Å ÌñâÎèô Î∂àÍ∞Ä',dmg:18},
{name:'ÎèåÏßÑ',icon:'üèÉ',desc:'Ï∞®ÏßÄ+ÎÑâÎ∞± ‚Äî ÎèåÍ≤© Í≥µÍ≤©',dmg:26},
{name:'Î∞©Ìå®Ïò¨Î¶¨Í∏∞',icon:'üõ°Ô∏è',desc:'Î∞©Ïñ¥+Î∞òÍ≤© ‚Äî ÌîºÌï¥ Í∞êÏÜå',buff:true,dmg:0},
{name:'ÏßÄÏßÑ',icon:'üåã',desc:'ÏßÅÏÑ† Í∑†Ïó¥ ‚Äî Î≤îÏúÑ Í≥µÍ≤©',dmg:28,aoe:true},
{name:'Ï†ÑÌà¨Ïùò Ìï®ÏÑ±',icon:'üìØ',desc:'ATK +30% Î≤ÑÌîÑ',buff:true,dmg:0},
{name:'Ï≤òÌòï',icon:'‚ö∞Ô∏è',desc:'Îî∏Ìîº Ï†Å Ï¶âÏÇ¨Í∏â ‚Äî ÎßàÎ¨¥Î¶¨Í∏∞',dmg:60}],
passives:[
{name:'ÌîºÌù° 20%',icon:'ü©∏',desc:'Îç∞ÎØ∏ÏßÄÏùò 20%Î•º HPÎ°ú ÌöåÎ≥µ'},
{name:'Î∞òÏÇ¨ÎéÄ 100%',icon:'ü™û',desc:'Î∞õÎäî Îç∞ÎØ∏ÏßÄ 100% Î∞òÏÇ¨'},
{name:'HP +40%',icon:'üí™',desc:'ÏµúÎåÄ HP 40% Ï¶ùÍ∞Ä'},
{name:'Îî∏Ìîº DEF +50%',icon:'üõ°Ô∏è',desc:'HP 20% Ïù¥Ìïò Ïãú DEF 50% Ï¶ùÍ∞Ä'},
{name:'ÎÇÆÏùÄHP=ÎÜíÏùÄATK',icon:'üò§',desc:'HPÍ∞Ä ÎÇÆÏùÑÏàòÎ°ù ATK Ï¶ùÍ∞Ä (ÏµúÎåÄ +50%)'},
{name:'10ÌîºÍ≤© ÏôÑÏ†ÑÎ∞©Ïñ¥',icon:'üî∞',desc:'10Î≤à ÌîºÍ≤©ÎßàÎã§ ÏôÑÏ†Ñ Î∞©Ïñ¥'}]}
};

const HUNT_TEMPLATES=[
{name:'Ïñ¥ÎëêÏö¥ Ïà≤',intro:['Ïö∏Ï∞ΩÌïú Ïà≤ ÏÜçÏúºÎ°ú Î∞úÍ±∏ÏùåÏùÑ ÏòÆÍ≤ºÎã§...','ÎÇòÎ≠áÍ∞ÄÏßÄ ÏÇ¨Ïù¥Î°ú Î∂àÍ∏∏Ìïú ÎààÎπõÏù¥ Î≤àÎú©Ïù∏Îã§.'],enemies:['Í≥†Î∏îÎ¶∞','Ïà≤ ÎäëÎåÄ','ÎèÖÎ≤ÑÏÑØ Ï†ïÎ†π'],boss:'Ïà≤Ïùò ÏàòÌò∏Ïûê ÏóîÌä∏',bossEmoji:'üå≤'},
{name:'ÏûäÌòÄÏßÑ ÎèôÍµ¥',intro:['ÏäµÍ∏∞ Ï∞¨ ÎèôÍµ¥ ÍπäÏàôÏù¥ Îì§Ïñ¥ÏÑ∞Îã§...','Î≤ΩÎ©¥ÏóêÏÑú Í∏∞Î¨òÌïú ÎπõÏù¥ ÏÉàÏñ¥ÎÇòÏò®Îã§.'],enemies:['Î∞ïÏ•ê Îñº','ÎèôÍµ¥ Ìä∏Î°§','ÌÅ¨Î¶¨Ïä§ÌÉà Í≥®Î†ò'],boss:'Ïã¨Ïó∞Ïùò Í±∞ÎØ∏ Ïó¨Ïôï',bossEmoji:'üï∑Ô∏è'},
{name:'Í≥†ÎåÄ Ïú†Ï†Å',intro:['Î¨¥ÎÑàÏßÑ Ïã†Ï†ÑÏùò ÏûîÌï¥Î•º ÎÑòÏóàÎã§...','Í≥µÍ∏∞ Ï§ëÏóê ÎßàÎ†•Ïù¥ Í∞êÎèàÎã§.'],enemies:['Ïä§ÏºàÎ†àÌÜ§ Î≥ëÏÇ¨','Ï†ÄÏ£ºÎ∞õÏùÄ ÏÑùÏÉÅ','Ïú†Î†π ÎßàÎ≤ïÏÇ¨'],boss:'Î∂àÎ©∏Ïùò Î¶¨Ïπò Ïôï',bossEmoji:'üíÄ'},
{name:'ÌôîÏÇ∞ ÏßÄÎåÄ',intro:['Î∞úÎ∞ëÏóêÏÑú Ïö©ÏïîÏù¥ Î∂ÄÍ∏ÄÍ±∞Î¶∞Îã§...','Ïó¥Í∏∞Í∞Ä ÌîºÎ∂ÄÎ•º ÌÉúÏö∏ ÎìØÌïòÎã§.'],enemies:['ÌôîÏóº ÎèÑÎßàÎ±Ä','Ïö©Ïïî Ïä¨ÎùºÏûÑ','Î∂àÏùò Ï†ïÎ†π'],boss:'ÌôîÏóºÍµ∞Ï£º Ïù¥ÌîÑÎ¶¨Ìä∏',bossEmoji:'üî•'},
{name:'ÏñºÏñ¥Î∂ôÏùÄ ÏÑ§Ïõê',intro:['Îß§ÏÑúÏö¥ ÎààÎ≥¥ÎùºÍ∞Ä ÏãúÏïºÎ•º Í∞ÄÎ¶∞Îã§...','Î∞úÏûêÍµ≠Ïù¥ ÏàúÏãùÍ∞ÑÏóê ÎààÏóê Î¨ªÌûåÎã§.'],enemies:['ÏñºÏùå ÎäëÎåÄ','ÌîÑÎ°úÏä§Ìä∏ Í≥®Î†ò','ÎààÎ≥¥Îùº Ïú†Î†π'],boss:'Í≤®Ïö∏Ïôï ÌîÑÎ¶¨Ï¶àÎ≤à',bossEmoji:'‚ùÑÔ∏è'},
{name:'ÎèÖÏùò Îä™ÏßÄÎåÄ',intro:['ÏßàÌçΩÌïú Îä™ÏùÑ Ï°∞Ïã¨Ïä§Î†à Í±∑ÎäîÎã§...','ÎèÖÍ∏∞ Ïñ¥Î¶∞ ÏïàÍ∞úÍ∞Ä ÌîºÏñ¥Ïò§Î•∏Îã§.'],enemies:['ÎèÖ Í∞úÍµ¨Î¶¨','Îä™ÏßÄ ÌûàÎìúÎùº','Î∂ÄÌå® Ï¢ÄÎπÑ'],boss:'ÎèÖÎ£° Î≤†ÎÖ∏ÏÇ¨Ïö∞Î•¥',bossEmoji:'üêâ'},
{name:'ÌïòÎäòÏùò ÌÉë',intro:['Íµ¨Î¶ÑÏùÑ Îö´Í≥† ÏÜüÏùÄ ÌÉëÏóê Ïò¨ÎûêÎã§...','Î∞îÎûåÏù¥ Í∑ìÍ∞ÄÏóê ÏÜçÏÇ≠Ïù∏Îã§.'],enemies:['ÌïòÌîº','Ï≤úÎë• Îß§','Î∞îÎûåÏùò Ï†ïÎ†π'],boss:'Ìè≠ÌíçÏùò ÏßÄÎ∞∞Ïûê ÎùºÏù¥Ïø†',bossEmoji:'‚ö°'},
{name:'ÏßÄÌïò Í∞êÏò•',intro:['Ïá†ÏÇ¨Ïä¨ ÎÅåÎ¶¨Îäî ÏÜåÎ¶¨Í∞Ä Ïö∏Î†§ÌçºÏßÑÎã§...','Ïñ¥Îë† ÏÜçÏóêÏÑú Ïã†ÏùåÏù¥ Îì§Î¶∞Îã§.'],enemies:['Í∞êÏò• Ï•êÏù∏Í∞Ñ','ÌÉàÏò• Í≥®Î†ò','Ïñ¥Îë† Í∏∞ÏÇ¨'],boss:'Í≥†Î¨∏Í¥Ä Î∏îÎü¨ÎìúÎ©îÏù∏',bossEmoji:'‚õìÔ∏è'},
{name:'Î≤ÑÎ†§ÏßÑ Í¥ëÏÇ∞',intro:['Í¥ëÏÇ∞ ÏàòÎ†àÏùò ÎÖπÏä® Î∞îÌÄ¥Í∞Ä ÏÇêÍ±±Ïù∏Îã§...','Í≥°Í¥≠Ïù¥ ÏÜåÎ¶¨Í∞Ä ÍπäÏùÄ Í≥≥ÏóêÏÑú Ïö∏Î¶∞Îã§.'],enemies:['Í¥ëÏÇ∞ ÎìúÏõåÌîÑ','Î≥¥ÏÑù Í±∞ÎØ∏','Ìè≠Î∞ú Î∞ïÏ•ê'],boss:'Í¥ëÏÇ∞Ïôï ÎëêÎ¶∞Ïùò ÎßùÎ†π',bossEmoji:'‚õèÔ∏è'},
{name:'Îã¨Îπõ Î¨òÏßÄ',intro:['Î≥¥Î¶ÑÎã¨ ÏïÑÎûò Î¨òÎπÑÎì§Ïù¥ Ï§ÑÏßÄÏñ¥ ÏÑúÏûàÎã§...','ÎïÖ ÏÜçÏóêÏÑú Î¨¥Ïñ∏Í∞Ä ÍøàÌãÄÍ±∞Î¶∞Îã§.'],enemies:['Ìï¥Í≥® Í∂ÅÏàò','Íµ¨Ïö∏','Î∞¥Ïãú'],boss:'Ï£ΩÏùåÏùò Í∏∞ÏÇ¨ Î™®Î•¥Í∞ÄÎÇò',bossEmoji:'üåô'},
{name:'ÏÇ¨Îßâ Ïò§ÏïÑÏãúÏä§',intro:['ÎÅùÏóÜÎäî Î™®ÎûòÏÇ¨ÎßâÏùÑ Í±¥ÎÑåÎã§...','Ïã†Í∏∞Î£® ÎÑàÎ®∏ Ïò§ÏïÑÏãúÏä§Í∞Ä Î≥¥Ïù∏Îã§.'],enemies:['ÏÇ¨Îßâ Ï†ÑÍ∞à','Î™®Îûò Ïõú','ÎØ∏Îùº'],boss:'ÏÇ¨ÎßâÏùò ÌååÎùºÏò§ ÏïÑÎàÑÎπÑÏä§',bossEmoji:'üèúÔ∏è'},
{name:'ÏàòÏ†ï ÎèôÍµ¥',intro:['ÌòïÌòïÏÉâÏÉâ ÏàòÏ†ïÏù¥ ÎπõÏùÑ Î∞úÌïúÎã§...','Í≥µÎ™ÖÌïòÎäî ÏàòÏ†ï ÏÜåÎ¶¨Í∞Ä Í∑ÄÎ•º Ïö∏Î¶∞Îã§.'],enemies:['ÏàòÏ†ï Î∞ïÏ•ê','ÌîÑÎ¶¨Ï¶ò Ïä¨ÎùºÏûÑ','ÎßàÎÇò Ìù°ÏàòÏ≤¥'],boss:'ÏàòÏ†ïÎ£° ÌÅ¨Î¶¨Ïä§ÌÉàÎ¶¨ÏïÑ',bossEmoji:'üíé'}
];

const ITEM_PREFIX=['Í≥†ÎåÄÏùò','Î∂àÌÉÄÎäî','ÏñºÏñ¥Î∂ôÏùÄ','Ï†ÄÏ£ºÎ∞õÏùÄ','Ï∂ïÎ≥µÎ∞õÏùÄ','Ïã†ÎπÑÌïú','ÌîºÎ¨ªÏùÄ','ÏòÅÏõêÏùò'];
const ITEM_MATERIAL=['Í∞ïÏ≤†','ÎØ∏Ïä§Î¶¥','ÌùëÏöîÏÑù','ÎìúÎûòÍ≥§','Ïò§Î¶¨Ìï†ÏΩò','ÏïÑÎã§ÎßåÌã∞ÏõÄ'];
const ITEM_SUFFIX={weapon:['Í≤Ä','ÏßÄÌå°Ïù¥','Ìôú','ÎèÑÎÅº','Ï¥ù'],armor:['Í∞ëÏò∑','Ìà¨Íµ¨','Ïû•Í∞ë'],accessory:['Î™©Í±∏Ïù¥','Î∞òÏßÄ','Î∂ÄÏ†Å']};
const ITEM_EMOJIS={weapon:['üó°Ô∏è','ü™Ñ','üèπ','ü™ì','üî´'],armor:['üõ°Ô∏è','‚õëÔ∏è','üß§'],accessory:['üìø','üíç','üîÆ']};
const GRADE_WEIGHTS=[{g:'ÏùºÎ∞ò',w:60},{g:'Î†àÏñ¥',w:25},{g:'Ïú†ÎãàÌÅ¨',w:12},{g:'ÏóêÌîΩ',w:3}];
const GRADE_COLORS={ÏùºÎ∞ò:'#999',Î†àÏñ¥:'var(--blue)',Ïú†ÎãàÌÅ¨:'var(--purple)',ÏóêÌîΩ:'var(--orange)'};
const FLAVOR_TEXTS=['Ïù¥ Ïû•ÎπÑÏóêÏÑú Ïïå Ïàò ÏóÜÎäî ÌûòÏù¥ ÎäêÍª¥ÏßÑÎã§.','Ïò§ÎûòÎêú Ï†ÑÏû•Ïùò Í∏∞ÏñµÏù¥ ÏÑúÎ†§ÏûàÎã§.','Ï†úÏûëÏûêÏùò ÌòºÏù¥ Îã¥Í∏¥ Î™ÖÌíàÏù¥Îã§.','Ïñ¥Îë† ÏÜçÏóêÏÑú Ìù¨ÎØ∏ÌïòÍ≤å ÎπõÎÇúÎã§.','ÏÜêÏóê Ï•êÎ©¥ Ï†ÑÏú®Ïù¥ ÎäêÍª¥ÏßÑÎã§.','ÏàòÎßéÏùÄ Ï†ÑÌà¨Î•º Í≤™ÏùÄ ÌùîÏ†ÅÏù¥ ÏûàÎã§.','Ïã†ÎπÑÎ°úÏö¥ Î¨∏ÏñëÏù¥ ÏÉàÍ≤®Ï†∏ ÏûàÎã§.','Ï†ÑÏÑ§ ÏÜç Ïû•Ïù∏Ïù¥ ÎßåÎì§ÏóàÎã§Í≥† Ï†ÑÌï¥ÏßÑÎã§.'];

const LEVELUP_BUFFS=[
{name:'HP +20',desc:'ÏµúÎåÄ Ï≤¥Î†• 20 Ï¶ùÍ∞Ä',apply:p=>{p.maxHP+=20;p.hp=Math.min(p.hp+20,p.maxHP)}},
{name:'ATK +5',desc:'Í≥µÍ≤©Î†• 5 Ï¶ùÍ∞Ä',apply:p=>{p.atk+=5}},
{name:'DEF +3',desc:'Î∞©Ïñ¥Î†• 3 Ï¶ùÍ∞Ä',apply:p=>{p.def+=3}},
{name:'Í≥®Îìú +100',desc:'Í≥®Îìú 100 ÌöçÎìù',apply:p=>{p.gold+=100}},
{name:'HP ÌöåÎ≥µ',desc:'HP ÏôÑÏ†Ñ ÌöåÎ≥µ',apply:p=>{p.hp=p.maxHP}},
{name:'Î∞∞Í≥†Ìîî ÌöåÎ≥µ',desc:'Î∞∞Í≥†Ìîî 50 ÌöåÎ≥µ',apply:p=>{p.hunger=Math.min(100,p.hunger+50)}},
{name:'Í∏∞Î∂Ñ UP',desc:'Í∏∞Î∂Ñ 30 Ï¶ùÍ∞Ä',apply:p=>{p.mood=Math.min(100,p.mood+30)}},
{name:'ÌÅ¨Î¶¨Ìã∞Ïª¨ +5%',desc:'ÏπòÎ™ÖÌÉÄ ÌôïÎ•† 5% Ï¶ùÍ∞Ä',apply:p=>{p.critBonus=(p.critBonus||0)+5}},
];

// ===== GAME STATE =====
let G={};
function newGame(){return{className:'',classData:null,level:1,exp:0,hp:100,maxHP:100,atk:15,def:8,gold:100,points:10,hunger:100,mood:80,floor:1,equippedSkills:[],equippedPassives:[],allSkills:[],allPassives:[],equipment:{weapon:null,armor:null,accessory:null},inventory:[],critBonus:0,autoHunt:false,missionCooldowns:{},lastTick:Date.now()}}

// ===== SCREENS =====
function showScreen(id){document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));document.getElementById(id).classList.add('active');if(id==='class-screen')renderClassSelect();if(id==='main-screen'){renderMainScreen();startTicking()}}

// ===== TITLE PARTICLES =====
(function(){const c=document.getElementById('title-particles');for(let i=0;i<30;i++){const s=document.createElement('span');s.style.left=Math.random()*100+'%';s.style.animationDuration=(4+Math.random()*6)+'s';s.style.animationDelay=Math.random()*5+'s';s.style.width=s.style.height=(1+Math.random()*3)+'px';c.appendChild(s)}})();

// ===== CLASS SELECT =====
function renderClassSelect(){const c=document.getElementById('class-cards');c.innerHTML='';
Object.entries(CLASSES).forEach(([name,cls])=>{
const d=document.createElement('div');d.className='class-card';d.onclick=()=>{document.querySelectorAll('.class-card').forEach(x=>x.classList.remove('selected'));d.classList.add('selected');G=newGame();G.className=name;G.classData=cls;G.maxHP=cls.baseHP;G.hp=cls.baseHP;G.atk=cls.baseATK;G.def=cls.baseDEF;G.allSkills=[...cls.skills];G.allPassives=[...cls.passives];document.getElementById('class-confirm-btn').disabled=false};
d.innerHTML=`<div class="class-avatar" style="background:${cls.bodyColor}"><span style="font-size:36px">${cls.weapon}</span></div><div class="class-info"><h3>${name}</h3><p>${cls.desc}</p><div class="class-stats"><span>‚ù§Ô∏è${cls.baseHP}</span><span>‚öîÔ∏è${cls.baseATK}</span><span>üõ°Ô∏è${cls.baseDEF}</span></div></div>`;
c.appendChild(d)})}
function confirmClass(){if(!G.className)return;showScreen('skill-screen');renderSkillSelect()}

// ===== SKILL SELECT =====
let selectedActive=new Set(),selectedPassive=new Set(),hoveredSkill=null;
function renderSkillSelect(){selectedActive.clear();selectedPassive.clear();
const ag=document.getElementById('active-skill-grid');ag.innerHTML='';
G.allSkills.forEach((s,i)=>{const d=document.createElement('div');d.className='skill-item';d.onclick=()=>{if(selectedActive.has(i))selectedActive.delete(i);else if(selectedActive.size<3)selectedActive.add(i);renderSkillHighlights();showSkillDesc(s)};d.innerHTML=`<span class="icon">${s.icon}</span><span class="name">${s.name}</span>`;d.id='askill-'+i;ag.appendChild(d)});
const pg=document.getElementById('passive-skill-grid');pg.innerHTML='';
G.allPassives.forEach((s,i)=>{const d=document.createElement('div');d.className='skill-item';d.onclick=()=>{if(selectedPassive.has(i))selectedPassive.delete(i);else if(selectedPassive.size<2)selectedPassive.add(i);renderSkillHighlights();showSkillDesc(s)};d.innerHTML=`<span class="icon">${s.icon}</span><span class="name">${s.name}</span>`;d.id='pskill-'+i;pg.appendChild(d)});
renderSkillHighlights()}
function renderSkillHighlights(){G.allSkills.forEach((_,i)=>{const el=document.getElementById('askill-'+i);if(el)el.className='skill-item'+(selectedActive.has(i)?' selected':'')});
G.allPassives.forEach((_,i)=>{const el=document.getElementById('pskill-'+i);if(el)el.className='skill-item'+(selectedPassive.has(i)?' selected':'')});
document.getElementById('active-count').textContent=`ÏÑ†ÌÉù: ${selectedActive.size}/3`;
document.getElementById('passive-count').textContent=`ÏÑ†ÌÉù: ${selectedPassive.size}/2`;
document.getElementById('skill-confirm-btn').disabled=!(selectedActive.size===3&&selectedPassive.size===2)}
function showSkillDesc(s){document.getElementById('skill-desc-box').innerHTML=`<div class="title">${s.icon} ${s.name}</div><div class="desc">${s.desc}</div>`}
function confirmSkills(){G.equippedSkills=[...selectedActive].map(i=>G.allSkills[i]);G.equippedPassives=[...selectedPassive].map(i=>G.allPassives[i]);saveGame();showScreen('main-screen')}

// ===== MAIN SCREEN =====
function renderMainScreen(){updateBars();renderCharacter();renderEquipRow();renderSkillRow()}
function updateBars(){
document.getElementById('player-level').textContent=G.level;
document.getElementById('player-gold').textContent=G.gold;
document.getElementById('player-points').textContent=G.points;
document.getElementById('hp-bar').style.width=(G.hp/G.maxHP*100)+'%';
document.getElementById('hp-text').textContent=`${Math.floor(G.hp)}/${G.maxHP}`;
document.getElementById('hunger-bar').style.width=G.hunger+'%';
document.getElementById('hunger-text').textContent=Math.floor(G.hunger)+'%';
document.getElementById('mood-bar').style.width=G.mood+'%';
document.getElementById('mood-text').textContent=Math.floor(G.mood)+'%'}

function renderCharacter(){const area=document.getElementById('char-area');const cls=CLASSES[G.className];if(!cls)return;
let mouthClass='';if(G.mood>=70)mouthClass='happy';else if(G.mood>=40)mouthClass='';else if(G.mood>=20)mouthClass='sad';else mouthClass='angry';
let weaponEmoji=cls.weapon;if(G.equipment.weapon)weaponEmoji=G.equipment.weapon.emoji||cls.weapon;
let armorStyle=cls.bodyColor;if(G.equipment.armor){const ac=GRADE_COLORS[G.equipment.armor.grade];armorStyle=`linear-gradient(180deg,${ac},#111)`}
// Build sparkles
let sparklesHTML='<div class="char-sparkles">';
for(let i=0;i<6;i++){const x=20+Math.random()*160;const y=20+Math.random()*160;const delay=Math.random()*3;const dur=1.5+Math.random()*2;sparklesHTML+=`<span style="left:${x}px;top:${y}px;animation-delay:${delay}s;animation-duration:${dur}s"></span>`}
sparklesHTML+='</div>';
area.innerHTML=`<div class="character">${sparklesHTML}<div class="char-glow" style="background:${cls.glow}"></div><div class="char-body" style="background:${armorStyle}"><div class="char-face"><div class="char-eyes"><div class="char-eye"></div><div class="char-eye"></div></div><div class="char-mouth ${mouthClass}"></div></div></div><div class="char-weapon">${weaponEmoji}</div></div>`}

function renderEquipRow(){const row=document.getElementById('equip-row');
const slots=['weapon','armor','accessory'];const labels=['‚öîÔ∏è','üõ°Ô∏è','üìø'];
row.innerHTML=slots.map((s,i)=>{const item=G.equipment[s];return`<div class="equip-slot ${item?'has-item':''}" onclick="openOverlay('inventory','${s}')" style="${item?'border-color:'+GRADE_COLORS[item.grade]:''}">${item?item.emoji:labels[i]}</div>`}).join('')}

function renderSkillRow(){const row=document.getElementById('skill-equip-row');
row.innerHTML=G.equippedSkills.map(s=>`<div class="skill-slot" title="${s.name}">${s.icon}</div>`).join('')}

// ===== TICKING (hunger, mood) =====
let tickInterval;
function startTicking(){if(tickInterval)clearInterval(tickInterval);
const elapsed=(Date.now()-G.lastTick)/1000;
const hungerLoss=elapsed/30;
G.hunger=Math.max(0,G.hunger-hungerLoss);
if(G.hunger<=0)G.hp=Math.max(1,G.hp-elapsed/60*5);
G.lastTick=Date.now();
tickInterval=setInterval(()=>{
G.hunger=Math.max(0,G.hunger-0.033);
if(G.hunger<=0){G.hp=Math.max(1,G.hp-0.08);G.mood=Math.max(0,G.mood-0.02)}
if(G.hunger<20)G.mood=Math.max(0,G.mood-0.01);
G.lastTick=Date.now();
updateBars();renderCharacter();saveGame()},1000)}

// ===== OVERLAYS =====
function openOverlay(name,extra){document.getElementById('overlay-'+name).classList.add('active');
if(name==='hunt')renderHunt();
if(name==='mission')renderMissions();
if(name==='shop')renderShop('gold');
if(name==='inventory')renderInventory(extra);
if(name==='skills')renderSkillManage()}
function closeOverlay(name){document.getElementById('overlay-'+name).classList.remove('active');if(name==='hunt'){G.autoHunt=false;updateAutoHuntUI()}}

// ===== HUNTING =====
let huntInProgress=false;
function renderHunt(){document.getElementById('hunt-floor').textContent=G.floor;updateAutoHuntUI();updateHuntStatus()}
function updateHuntStatus(){var h=document.getElementById('hunt-hp');if(h){h.textContent=Math.floor(G.hp)+'/'+G.maxHP;document.getElementById('hunt-hunger').textContent=Math.floor(G.hunger)+'%';document.getElementById('hunt-mood').textContent=Math.floor(G.mood)+'%';document.getElementById('hunt-level').textContent=G.level;document.getElementById('hunt-gold').textContent=G.gold}}
function updateAutoHuntUI(){document.getElementById('auto-hunt-indicator').innerHTML=G.autoHunt?'<span class="auto-hunt-badge">ÏûêÎèô</span>':'';document.getElementById('auto-hunt-btn').textContent=G.autoHunt?'‚èπÔ∏è ÏûêÎèô Ï§ëÏßÄ':'üîÑ ÏûêÎèôÏÇ¨ÎÉ•'}
function toggleAutoHunt(){G.autoHunt=!G.autoHunt;updateAutoHuntUI();if(G.autoHunt&&!huntInProgress)startHunt()}

async function startHunt(){
if(huntInProgress)return;if(G.hp<=0){toast('HPÍ∞Ä Î∂ÄÏ°±Ìï©ÎãàÎã§!');return}
huntInProgress=true;document.getElementById('hunt-btn').disabled=true;
const log=document.getElementById('hunt-log');log.innerHTML='';
const isBoss=G.floor%5===0;
const tmpl=HUNT_TEMPLATES[Math.floor(Math.random()*HUNT_TEMPLATES.length)];
const enemy=isBoss?tmpl.boss:tmpl.enemies[Math.floor(Math.random()*tmpl.enemies.length)];
const enemyCount=isBoss?1:Math.floor(Math.random()*3)+1;
const enemyHP=isBoss?(30+G.floor*8):(10+G.floor*3);
let totalEnemyHP=enemyHP*enemyCount;

for(const line of tmpl.intro)await addHuntLine(line,'story',log);
await wait(400);
if(isBoss){await addHuntLine(`‚ö†Ô∏è Î≥¥Ïä§ Ï∂úÌòÑ! ${tmpl.bossEmoji} ${enemy}!`,'boss',log)}
else{await addHuntLine(`${enemy} ${enemyCount}ÎßàÎ¶¨Í∞Ä ÎÇòÌÉÄÎÇ¨Îã§!`,'story',log)}
await wait(300);

let rounds=isBoss?5:3+Math.floor(Math.random()*2);
let playerHPLoss=0;
if(isBoss&&!G.autoHunt){
await addHuntLine('‚ö° Ïä§ÌÇ¨Ï≤¥ÌÅ¨! ÌÉÄÏù¥Î∞çÏùÑ ÎßûÏ∂∞Îùº!','boss',log);
const scResult=await bossSkillCheck(rounds,log);
for(const r of scResult.rounds){
const skill=G.equippedSkills[r.skillIdx%G.equippedSkills.length];
let baseDmg=Math.floor((skill.dmg||20)*(1+G.atk/30));
if(G.equipment.weapon)baseDmg+=Math.floor(G.equipment.weapon.stats.ATK||0);
let dmg=r.type==='critical'?Math.floor(baseDmg*2.5):r.type==='hit'?Math.floor(baseDmg*1):Math.floor(baseDmg*0.3);
totalEnemyHP-=dmg;
const tag=r.type==='critical'?'üí•ÌÅ¨Î¶¨Ìã∞Ïª¨!! ':r.type==='hit'?'‚úÖ ':'‚ùåÎπóÎÇòÍ∞ê... ';
await addHuntLine(`${skill.icon} ${skill.name} ‚Üí ${tag}${dmg} Îç∞ÎØ∏ÏßÄ`,'action',log);
if(r.type==='miss'){const eDmg=Math.max(1,Math.floor((5+G.floor*2)*(0.8+Math.random()*0.4)-G.def/3));playerHPLoss+=eDmg;await addHuntLine(`${enemy}Ïùò Î∞òÍ≤©! ‚Üí -${eDmg} HP`,'damage',log)}
await wait(300)}
}else{
for(let r=0;r<rounds&&totalEnemyHP>0;r++){
const skill=G.equippedSkills[r%G.equippedSkills.length];
let baseDmg=Math.floor((skill.dmg||20)*(1+G.atk/30));
if(G.equipment.weapon)baseDmg+=Math.floor(G.equipment.weapon.stats.ATK||0);
const roll=Math.random()*100;
let dmg,tag;
if(isBoss){
if(roll<15){dmg=Math.floor(baseDmg*2.5);tag='üí•ÌÅ¨Î¶¨Ìã∞Ïª¨!! '}
else if(roll<70){dmg=Math.floor(baseDmg*(0.8+Math.random()*0.4));tag=''}
else{dmg=Math.floor(baseDmg*0.3);tag='‚ùåÎπóÎÇòÍ∞ê... '}
}else{
const critChance=10+(G.critBonus||0);
if(roll<critChance){dmg=Math.floor(baseDmg*1.5);tag='üí•ÌÅ¨Î¶¨Ìã∞Ïª¨! '}
else{dmg=Math.floor(baseDmg*(0.8+Math.random()*0.4));tag=''}
}
totalEnemyHP-=dmg;
await addHuntLine(`${skill.icon} ${skill.name} ÏãúÏ†Ñ! ‚Üí ${tag}${dmg} Îç∞ÎØ∏ÏßÄ`,'action',log);
await wait(300);
if(tag.includes('ÎπóÎÇòÍ∞ê')){const eDmg=Math.max(1,Math.floor((5+G.floor*2)*(0.8+Math.random()*0.4)-G.def/3));playerHPLoss+=eDmg;await addHuntLine(`${enemy}Ïùò Î∞òÍ≤©! ‚Üí -${eDmg} HP`,'damage',log);await wait(200)}
else if(totalEnemyHP>0&&Math.random()<0.4){const eDmg=Math.max(1,Math.floor((3+G.floor)*(0.6+Math.random()*0.4)-G.def/3));playerHPLoss+=eDmg;await addHuntLine(`${enemy}Ïùò Î∞òÍ≤©! ‚Üí -${eDmg} HP`,'damage',log);await wait(200)}}
}

const won=totalEnemyHP<=0;
G.hp=Math.max(1,G.hp-playerHPLoss);
G.hunger=Math.max(0,G.hunger-(isBoss?8:4));
if(won){
await addHuntLine('Ï†ÑÌà¨ ÏäπÎ¶¨! üéâ','victory',log);
const goldReward=Math.floor((10+G.floor*5)*(isBoss?3:1)*(0.8+Math.random()*0.4));
const expReward=Math.floor((15+G.floor*3)*(isBoss?2.5:1));
G.gold+=goldReward;G.exp+=expReward;
G.mood=Math.min(100,G.mood+(isBoss?15:5));
await addHuntLine(`ÌöçÎìù: üí∞ +${goldReward}, Í≤ΩÌóòÏπò +${expReward}`,'loot',log);
if(Math.random()<(isBoss?0.9:0.4)){const item=generateItem();G.inventory.push(item);
await addHuntLine(`ÏïÑÏù¥ÌÖú Î∞úÍ≤¨! [${item.name}] (${item.grade})`,'loot',log)}
if(!isBoss)G.floor++;
else{G.floor++;await addHuntLine(`üèÜ Î≥¥Ïä§ ÌÅ¥Î¶¨Ïñ¥! ${G.floor}Ï∏µÏúºÎ°ú ÏßÑÏ∂ú!`,'victory',log)}
while(G.exp>=100){G.exp-=100;G.level++;G.maxHP+=20;G.atk+=3;G.def+=2;G.hp=G.maxHP;showLevelUp()}
}else{
await addHuntLine('Ï†ÑÌà¨ Ìå®Î∞∞... üíÄ','damage',log);
G.mood=Math.max(0,G.mood-10)}
updateBars();updateHuntStatus();renderCharacter();renderEquipRow();saveGame();
huntInProgress=false;document.getElementById('hunt-btn').disabled=false;
if(G.autoHunt&&G.hp>G.maxHP*0.2){setTimeout(()=>{if(G.autoHunt)startHunt()},1500)}else{G.autoHunt=false;updateAutoHuntUI()}}

function addHuntLine(text,cls,log){return new Promise(r=>{const d=document.createElement('div');d.className='hunt-line '+cls;d.textContent=text;log.appendChild(d);log.scrollTop=log.scrollHeight;updateHuntStatus();setTimeout(r,200)})}

function bossSkillCheck(totalRounds,log){
return new Promise(resolve=>{
const results=[];let round=0;
const speed=2.5+G.floor*0.15;
const normalZone=18;const critZone=5;

function runRound(){
if(round>=totalRounds){resolve({rounds:results});return}
const wrap=document.createElement('div');wrap.className='sc-wrap';
const critStart=Math.floor(Math.random()*360);
const normalStart=(critStart-normalZone+360)%360;
const normalEnd=(critStart+critZone+normalZone)%360;
const critEnd=(critStart+critZone)%360;
const skill=G.equippedSkills[round%G.equippedSkills.length];

wrap.innerHTML=`
<div style="font-size:13px;color:var(--text2)">${skill.icon} ${skill.name} ‚Äî ÎùºÏö¥Îìú ${round+1}/${totalRounds}</div>
<div class="sc-gauge"><svg viewBox="0 0 200 200">
<circle cx="100" cy="100" r="85" fill="none" stroke="rgba(255,255,255,.08)" stroke-width="14"/>
<path d="${descArc(100,100,85,normalStart,(normalStart+normalZone*2+critZone)%360)}" fill="none" stroke="rgba(0,232,143,.3)" stroke-width="14" stroke-linecap="round"/>
<path d="${descArc(100,100,85,critStart,critEnd)}" fill="none" stroke="rgba(255,68,102,.5)" stroke-width="14" stroke-linecap="round"/>
<line id="sc-needle-${round}" x1="100" y1="100" x2="100" y2="20" stroke="var(--gold)" stroke-width="3" stroke-linecap="round"/>
</svg></div>
<div class="sc-info"><span>üü¢ ÏùºÎ∞ò</span><span>üî¥ ÌÅ¨Î¶¨Ìã∞Ïª¨</span></div>
<button class="sc-btn" id="sc-btn-${round}">‚ö° ÌÅ¥Î¶≠!</button>
<div class="sc-result" id="sc-res-${round}"></div>`;
log.appendChild(wrap);log.scrollTop=log.scrollHeight;

let angle=0,running=true,anim;
const needle=()=>wrap.querySelector('#sc-needle-'+round);
function tick(){if(!running)return;angle=(angle+speed)%360;const n=needle();if(n)n.setAttribute('transform','rotate('+angle+',100,100)');anim=requestAnimationFrame(tick)}
tick();

const btn=wrap.querySelector('#sc-btn-'+round);
btn.onclick=()=>{
running=false;if(anim)cancelAnimationFrame(anim);btn.disabled=true;
const a=angle;
const inCrit=isInArc(a,critStart,critEnd);
const inNormal=isInArc(a,normalStart,(normalStart+normalZone*2+critZone)%360);
const res=wrap.querySelector('#sc-res-'+round);
let type='miss';
if(inCrit){type='critical';res.innerHTML='<span style="color:var(--danger)">üí• ÌÅ¨Î¶¨Ìã∞Ïª¨!!!</span>'}
else if(inNormal){type='hit';res.innerHTML='<span style="color:var(--success)">‚úÖ Ï†ÅÏ§ë!</span>'}
else{res.innerHTML='<span style="color:var(--text2)">‚ùå ÎπóÎÇòÍ∞ê...</span>'}
results.push({skillIdx:round,type});round++;
setTimeout(runRound,600)}}
runRound()})
}
function descArc(cx,cy,r,s,e){s=s-90;e=e-90;const sr=s*Math.PI/180,er=e*Math.PI/180;const x1=cx+r*Math.cos(sr),y1=cy+r*Math.sin(sr),x2=cx+r*Math.cos(er),y2=cy+r*Math.sin(er);const large=((e-s+360)%360>180)?1:0;return`M${x1},${y1}A${r},${r},0,${large},1,${x2},${y2}`}
function isInArc(a,s,e){if(e>s)return a>=s&&a<=e;return a>=s||a<=e}
function wait(ms){return new Promise(r=>setTimeout(r,ms))}

// ===== ITEM GENERATION =====
function generateItem(){
const type=['weapon','armor','accessory'][Math.floor(Math.random()*3)];
const suffixes=ITEM_SUFFIX[type];const emojis=ITEM_EMOJIS[type];
const si=Math.floor(Math.random()*suffixes.length);
const prefix=ITEM_PREFIX[Math.floor(Math.random()*ITEM_PREFIX.length)];
const material=ITEM_MATERIAL[Math.floor(Math.random()*ITEM_MATERIAL.length)];
const name=`${prefix} ${material}Ïùò ${suffixes[si]}`;
const roll=Math.random()*100;let grade='ÏùºÎ∞ò';
if(roll<3)grade='ÏóêÌîΩ';else if(roll<15)grade='Ïú†ÎãàÌÅ¨';else if(roll<40)grade='Î†àÏñ¥';
const gMult={ÏùºÎ∞ò:1,Î†àÏñ¥:1.5,Ïú†ÎãàÌÅ¨:2.2,ÏóêÌîΩ:3.5}[grade];
const floorMult=1+G.floor*0.1;
const stats={};
if(type==='weapon'){stats.ATK=Math.floor((5+Math.random()*10)*gMult*floorMult);if(Math.random()>.5)stats['ÏπòÎ™ÖÌÉÄ']=Math.floor(Math.random()*5*gMult)+'%'}
else if(type==='armor'){stats.DEF=Math.floor((3+Math.random()*8)*gMult*floorMult);if(Math.random()>.5)stats.HP=Math.floor(Math.random()*20*gMult)}
else{stats.ATK=Math.floor((2+Math.random()*5)*gMult*floorMult);stats.DEF=Math.floor((1+Math.random()*3)*gMult*floorMult)}
const durability=Math.floor({ÏùºÎ∞ò:50,Î†àÏñ¥:80,Ïú†ÎãàÌÅ¨:120,ÏóêÌîΩ:180}[grade]*(0.8+Math.random()*0.4));
return{id:Date.now()+Math.random(),name,type,grade,emoji:emojis[si],stats,durability,maxDurability:durability,desc:FLAVOR_TEXTS[Math.floor(Math.random()*FLAVOR_TEXTS.length)]}}

// ===== INVENTORY =====
let invFilter=null;
function renderInventory(filter){invFilter=filter||null;
const detail=document.getElementById('item-detail-area');detail.innerHTML='';
const grid=document.getElementById('inv-grid');grid.innerHTML='';
for(let i=0;i<30;i++){const item=G.inventory[i];const d=document.createElement('div');d.className='inv-slot'+(item?' grade-'+item.grade:'');
if(item){d.innerHTML=`<span>${item.emoji}</span><div class="dur-bar"><div class="dur-fill" style="width:${item.durability/item.maxDurability*100}%"></div></div>`;d.onclick=()=>showItemDetail(i)}
grid.appendChild(d)}}

function showItemDetail(idx){const item=G.inventory[idx];if(!item)return;
const d=document.getElementById('item-detail-area');
const statsHTML=Object.entries(item.stats).map(([k,v])=>`<div>${k}: +${v}</div>`).join('');
const isEquipped=Object.values(G.equipment).some(e=>e&&e.id===item.id);
d.innerHTML=`<div class="item-detail"><div class="item-name grade-${item.grade}-text" style="color:${GRADE_COLORS[item.grade]}">${item.name}</div><div class="item-grade" style="color:${GRADE_COLORS[item.grade]}">${item.grade} ${item.type==='weapon'?'Î¨¥Í∏∞':item.type==='armor'?'Î∞©Ïñ¥Íµ¨':'Ïû•Ïã†Íµ¨'}</div><div class="item-stats">${statsHTML}</div><div style="font-size:12px;color:var(--text2)">ÎÇ¥Íµ¨ÎèÑ: ${item.durability}/${item.maxDurability}</div><div class="item-desc">${item.desc}</div><div class="item-actions">${isEquipped?`<button class="btn btn-sm btn-secondary" onclick="unequipItem('${item.type}')">Ìï¥Ï†ú</button>`:`<button class="btn btn-sm" onclick="equipItem(${idx})">Ïû•Ï∞©</button>`}<button class="btn btn-sm btn-secondary" onclick="repairItem(${idx})">ÏàòÎ¶¨ (üí∞${Math.floor((item.maxDurability-item.durability)*0.5)})</button><button class="btn btn-sm btn-secondary" onclick="sellItem(${idx})">ÌåêÎß§ (üí∞${Math.floor(({ÏùºÎ∞ò:5,Î†àÏñ¥:15,Ïú†ÎãàÌÅ¨:40,ÏóêÌîΩ:100}[item.grade])*(1+G.floor*0.1))})</button></div></div>`}

function equipItem(idx){const item=G.inventory[idx];if(!item)return;
if(G.equipment[item.type])G.inventory.push(G.equipment[item.type]);
G.equipment[item.type]=item;G.inventory.splice(idx,1);
toast(`${item.name} Ïû•Ï∞©!`);renderInventory();renderEquipRow();renderCharacter();saveGame()}
function unequipItem(type){if(!G.equipment[type])return;G.inventory.push(G.equipment[type]);G.equipment[type]=null;
toast('Ïû•ÎπÑ Ìï¥Ï†ú');renderInventory();renderEquipRow();renderCharacter();saveGame()}
function repairItem(idx){const item=G.inventory[idx];if(!item)return;const cost=Math.floor((item.maxDurability-item.durability)*0.5);if(G.gold<cost){toast('Í≥®ÎìúÍ∞Ä Î∂ÄÏ°±Ìï©ÎãàÎã§!');return}G.gold-=cost;item.durability=item.maxDurability;toast('ÏàòÎ¶¨ ÏôÑÎ£å!');renderInventory();showItemDetail(idx);updateBars();saveGame()}
function sellItem(idx){const item=G.inventory[idx];if(!item)return;const price=Math.floor(({ÏùºÎ∞ò:5,Î†àÏñ¥:15,Ïú†ÎãàÌÅ¨:40,ÏóêÌîΩ:100}[item.grade])*(1+G.floor*0.1));G.gold+=price;G.inventory.splice(idx,1);toast(`ÌåêÎß§ ÏôÑÎ£å! üí∞+${price}`);document.getElementById('item-detail-area').innerHTML='';renderInventory();updateBars();saveGame()}

// ===== SHOP =====
let currentShopTab='gold';
const GOLD_SHOP=[
{name:'Îπµ',icon:'üçû',desc:'Î∞∞Í≥†Ìîî 30 ÌöåÎ≥µ',price:20,currency:'gold',action:()=>{G.hunger=Math.min(100,G.hunger+30);toast('ÎπµÏùÑ Î®πÏóàÎã§! üçû')}},
{name:'Ïä§ÌÖåÏù¥ÌÅ¨',icon:'ü•©',desc:'Î∞∞Í≥†Ìîî 70 ÌöåÎ≥µ',price:50,currency:'gold',action:()=>{G.hunger=Math.min(100,G.hunger+70);toast('Ïä§ÌÖåÏù¥ÌÅ¨Î•º Î®πÏóàÎã§! ü•©')}},
{name:'HP Ìè¨ÏÖò',icon:'üß™',desc:'HP 50 ÌöåÎ≥µ',price:30,currency:'gold',action:()=>{G.hp=Math.min(G.maxHP,G.hp+50);toast('HP ÌöåÎ≥µ! üß™')}},
{name:'Í≥†Í∏â HP Ìè¨ÏÖò',icon:'‚öóÔ∏è',desc:'HP ÏôÑÏ†Ñ ÌöåÎ≥µ',price:80,currency:'gold',action:()=>{G.hp=G.maxHP;toast('HP ÏôÑÏ†Ñ ÌöåÎ≥µ! ‚öóÔ∏è')}},
{name:'Í∏∞Î∂ÑÏ†ÑÌôò Îß•Ï£º',icon:'üç∫',desc:'Í∏∞Î∂Ñ 40 ÌöåÎ≥µ',price:25,currency:'gold',action:()=>{G.mood=Math.min(100,G.mood+40);toast('Í∏∞Î∂ÑÏù¥ Ï¢ãÏïÑÏ°åÎã§! üç∫')}},
];
const POINT_SHOP=[
{name:'ÏóòÎ¶≠ÏÑú',icon:'‚ú®',desc:'Ïû•ÎπÑ ÎÇ¥Íµ¨ÎèÑ ÏòÅÍµ¨Ìôî (ÎØ∏Íµ¨ÌòÑ)',price:50,currency:'point',action:()=>{toast('Ï§ÄÎπÑ Ï§ëÏûÖÎãàÎã§!')}},
{name:'Ïä§ÌÇ¨ Î¶¨ÏÖã',icon:'üîÑ',desc:'Ïä§ÌÇ¨ Î°úÎìúÏïÑÏõÉ Ï¥àÍ∏∞Ìôî',price:30,currency:'point',action:()=>{showScreen('skill-screen');renderSkillSelect();toast('Ïä§ÌÇ¨ÏùÑ Îã§Ïãú ÏÑ†ÌÉùÌïòÏÑ∏Ïöî!')}},
{name:'Ï∫êÎ¶≠ÌÑ∞ Ïä¨Î°Ø',icon:'üë§',desc:'Ï∂îÍ∞Ä Ï∫êÎ¶≠ÌÑ∞ Ïä¨Î°Ø',price:100,currency:'point',disabled:true,action:()=>{toast('Ï§ÄÎπÑÏ§ë...')}},
];
function renderShop(tab){currentShopTab=tab;
document.querySelectorAll('.shop-tab').forEach((t,i)=>t.classList.toggle('active',i===(tab==='gold'?0:1)));
const items=tab==='gold'?GOLD_SHOP:POINT_SHOP;
document.getElementById('shop-items').innerHTML=items.map((item,i)=>`<div class="shop-item ${item.disabled?'style="opacity:.4"':''}" onclick="buyShopItem('${tab}',${i})"><div class="s-icon">${item.icon}</div><div class="s-info"><div class="s-name">${item.name}</div><div class="s-desc">${item.desc}</div></div><div class="s-price">${tab==='gold'?'üí∞':'üíé'} ${item.price}</div></div>`).join('')}
function switchShopTab(tab,el){renderShop(tab)}
function buyShopItem(tab,idx){const items=tab==='gold'?GOLD_SHOP:POINT_SHOP;const item=items[idx];if(item.disabled)return toast('Ï§ÄÎπÑÏ§ëÏûÖÎãàÎã§!');
const cur=tab==='gold'?'gold':'points';if(G[cur]<item.price)return toast('Ïû¨ÌôîÍ∞Ä Î∂ÄÏ°±Ìï©ÎãàÎã§!');
G[cur]-=item.price;item.action();updateBars();renderCharacter();saveGame()}

// ===== MISSIONS =====
const MISSIONS=[
{npc:'ÎåÄÏû•Ïû•Ïù¥ Î™®Î£®Ïä§',avatar:'üî®',color:'#8B4513',dialogue:'Ïö©ÏÇ¨Ïó¨, ÎÇ¥ ÎåÄÏû•Í∞ÑÏóê Ïì∏ Ïû¨Î£åÍ∞Ä Î∂ÄÏ°±ÌïòÏò§. Î™®Ìóò Ï§ëÏóê Í¥ëÏÑùÏùÑ Ï∞æÏïÑÏôÄ Ï£ºÏãúÏò§!',reward:'üí∞ 80 + üíé 5',gold:80,points:5},
{npc:'ÎßàÎ≤ïÏÇ¨ ÏóòÎìúÎ¶∞',avatar:'üßô',color:'#4B0082',dialogue:'Í≥†ÎåÄ ÎßàÎ≤ïÏßÑÏùò ÏûîÏû¨Î•º Ïó∞Íµ¨ Ï§ëÏù¥Ïò§. Ïú†Ï†ÅÏóêÏÑú ÎßàÎ†• Í≤∞Ï†ïÏùÑ Í∞ÄÏ†∏Îã§ Ï£ºÏãúÏò§.',reward:'üí∞ 60 + üíé 8',gold:60,points:8},
{npc:'Ï†ïÏ∞∞Î≥ë Ïπ¥Ïù¥',avatar:'üèπ',color:'#2F4F4F',dialogue:'Ïà≤ Ïô∏Í≥ΩÏóê ÏàòÏÉÅÌïú ÏõÄÏßÅÏûÑÏù¥ Ìè¨Ï∞©ÎêêÏäµÎãàÎã§. Ï†ïÏ∞∞ÏùÑ Î∂ÄÌÉÅÎìúÎ¶ΩÎãàÎã§!',reward:'üí∞ 50 + üíé 3',gold:50,points:3},
{npc:'Ï£ºÏ†êÏ£ºÏù∏ Î¶¥Îùº',avatar:'üç∫',color:'#8B008B',dialogue:'ÏöîÏ¶ò ÏÜêÎãòÎì§Ïù¥ Ïù¥ÏÉÅÌïú ÏÜåÎ¨∏ÏùÑ ÌçºÎú®Î¶¨Í≥† ÏûàÏñ¥Ïöî. ÏßÑÏÉÅÏùÑ ÏïåÏïÑÎ¥ê Ï£ºÏÑ∏Ïöî~',reward:'üí∞ 40 + üíé 10',gold:40,points:10}
];
function renderMissions(){const body=document.getElementById('mission-body');body.innerHTML='';
MISSIONS.forEach((m,i)=>{const cd=G.missionCooldowns[i]||0;const remaining=Math.max(0,cd-Date.now());const onCD=remaining>0;
body.innerHTML+=`<div class="mission-card"><div class="cpq-badge">CPQ ÎØ∏ÏÖò</div><div class="npc-row"><div class="npc-avatar" style="background:${m.color}">${m.avatar}</div><div><div class="npc-name">${m.npc}</div></div></div><div class="npc-dialogue">"${m.dialogue}"</div><div class="mission-reward">Î≥¥ÏÉÅ: ${m.reward}</div>${onCD?`<div class="cooldown">‚è≥ ÎåÄÍ∏∞ Ï§ë... ${Math.ceil(remaining/1000)}Ï¥à</div>`:`<button class="btn btn-sm" onclick="completeMission(${i})">ÏôÑÎ£å</button>`}</div>`})}
function completeMission(i){const m=MISSIONS[i];G.gold+=m.gold;G.points+=m.points;G.missionCooldowns[i]=Date.now()+30000;
toast(`ÎØ∏ÏÖò ÏôÑÎ£å! üí∞+${m.gold} üíé+${m.points}`);updateBars();saveGame();renderMissions();
const refreshTimer=setInterval(()=>{if(!document.getElementById('overlay-mission').classList.contains('active')){clearInterval(refreshTimer);return}renderMissions()},1000)}

// ===== SKILL MANAGE =====
function renderSkillManage(){const body=document.getElementById('skills-body');body.innerHTML='<h3 style="color:var(--gold);margin-bottom:12px;font-size:15px">üó°Ô∏è Ïï°Ìã∞Î∏å Ïä§ÌÇ¨</h3>';
G.allSkills.forEach((s,i)=>{const equipped=G.equippedSkills.some(e=>e.name===s.name);
body.innerHTML+=`<div class="skill-manage-item ${equipped?'equipped':''}" onclick="toggleSkillEquip(${i},'active')"><div class="sk-icon">${s.icon}</div><div class="sk-info"><div class="sk-name">${s.name} ${equipped?'‚úÖ':''}</div><div class="sk-desc">${s.desc}</div></div></div>`});
body.innerHTML+='<h3 style="color:var(--gold);margin:18px 0 12px;font-size:15px">üõ°Ô∏è Ìå®ÏãúÎ∏å Ïä§ÌÇ¨</h3>';
G.allPassives.forEach((s,i)=>{const equipped=G.equippedPassives.some(e=>e.name===s.name);
body.innerHTML+=`<div class="skill-manage-item ${equipped?'equipped':''}" onclick="toggleSkillEquip(${i},'passive')"><div class="sk-icon">${s.icon}</div><div class="sk-info"><div class="sk-name">${s.name} ${equipped?'‚úÖ':''}</div><div class="sk-desc">${s.desc}</div></div></div>`})}
function toggleSkillEquip(idx,type){
if(type==='active'){const s=G.allSkills[idx];const ei=G.equippedSkills.findIndex(e=>e.name===s.name);
if(ei>=0)G.equippedSkills.splice(ei,1);else if(G.equippedSkills.length<3)G.equippedSkills.push(s);else{toast('ÏµúÎåÄ 3Í∞úÍπåÏßÄ Ïû•Ï∞© Í∞ÄÎä•Ìï©ÎãàÎã§');return}}
else{const s=G.allPassives[idx];const ei=G.equippedPassives.findIndex(e=>e.name===s.name);
if(ei>=0)G.equippedPassives.splice(ei,1);else if(G.equippedPassives.length<2)G.equippedPassives.push(s);else{toast('ÏµúÎåÄ 2Í∞úÍπåÏßÄ Ïû•Ï∞© Í∞ÄÎä•Ìï©ÎãàÎã§');return}}
renderSkillManage();renderSkillRow();saveGame()}

// ===== LEVEL UP =====
function showLevelUp(){const ol=document.getElementById('levelup-overlay');ol.classList.add('active');
document.getElementById('levelup-sub').textContent=`Lv.${G.level} Îã¨ÏÑ±! HP+20, ATK+3, DEF+2`;
const choices=[];const pool=[...LEVELUP_BUFFS];
for(let i=0;i<3;i++){const idx=Math.floor(Math.random()*pool.length);choices.push(pool.splice(idx,1)[0])}
document.getElementById('levelup-choices').innerHTML=choices.map((c,i)=>`<div class="levelup-choice" onclick="pickLevelBuff(${i})"><div class="lc-name">${c.name}</div><div class="lc-desc">${c.desc}</div></div>`).join('');
const pc=document.getElementById('levelup-particles');pc.innerHTML='';
for(let i=0;i<30;i++){const p=document.createElement('div');p.className='particle';p.style.left=Math.random()*100+'%';p.style.top=Math.random()*100+'%';p.style.width=p.style.height=(4+Math.random()*8)+'px';p.style.background=['var(--gold)','#fff','var(--accent)','var(--success)'][Math.floor(Math.random()*4)];p.style.animationDelay=Math.random()*2+'s';p.style.animationDuration=(0.5+Math.random())+'s';pc.appendChild(p)}
window._levelChoices=choices;
document.getElementById('auto-levelup-toggle').checked=!!G.autoLevelUp;
if(G.autoLevelUp){setTimeout(()=>pickLevelBuff(Math.floor(Math.random()*3)),500);return}}
function pickLevelBuff(i){window._levelChoices[i].apply(G);
document.getElementById('levelup-overlay').classList.remove('active');
toast(`${window._levelChoices[i].name} ÌöçÎìù!`);updateBars();renderCharacter();saveGame()}

// ===== TOAST =====
function toast(msg){const t=document.createElement('div');t.className='toast';t.textContent=msg;document.body.appendChild(t);setTimeout(()=>t.remove(),2500)}

// ===== SAVE/LOAD =====
function saveGame(){const s={...G};delete s.classData;s.className_=G.className;localStorage.setItem('symmetry_save',JSON.stringify(s))}
function loadGame(){const raw=localStorage.getItem('symmetry_save');if(!raw){toast('Ï†ÄÏû•Îêú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§');return}
try{const s=JSON.parse(raw);G=s;G.className=s.className_;G.classData=CLASSES[G.className];if(!G.classData){toast('ÏûòÎ™ªÎêú ÏÑ∏Ïù¥Î∏å Îç∞Ïù¥ÌÑ∞');return}
G.allSkills=G.classData.skills;G.allPassives=G.classData.passives;
G.equippedSkills=G.equippedSkills.map(es=>G.allSkills.find(s=>s.name===es.name)||es);
G.equippedPassives=G.equippedPassives.map(ep=>G.allPassives.find(p=>p.name===ep.name)||ep);
if(!G.missionCooldowns)G.missionCooldowns={};if(!G.critBonus)G.critBonus=0;
showScreen('main-screen');toast('Í≤åÏûÑ Î°úÎìú ÏôÑÎ£å!')}catch(e){toast('Î°úÎìú Ïã§Ìå®: '+e.message)}}

// Init
renderClassSelect();
</script>
</body>
</html>
